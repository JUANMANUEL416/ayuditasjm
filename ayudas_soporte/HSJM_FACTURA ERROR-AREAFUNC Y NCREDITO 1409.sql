BEGIN TRAN --3722
UPDATE MCH SET MCH.CUENTA = MCH.IDAREA + '001', MCH.ESTADO = '1'
--SELECT MCH.NROCOMPROBANTE, MCH.NROASIENTO, MCH.IDAREA, MCH.CCOSTO, MCH.CUENTA
FROM   MCH INNER JOIN (
                        SELECT NROCOMPROBANTE, ANO, MES, FECHACONTABLE
                        FROM   MCP 
                        WHERE  MCP.ESTADO = '0'
                        AND    MCP.COMPROBANTE = '10'
                        AND    MCP.ANULADO <> 1
                        AND    EXISTS (SELECT * FROM MCH WHERE MCH.NROCOMPROBANTE = MCP.NROCOMPROBANTE)
                        AND    MCP.TOTALDEBITO = MCP.TOTALCREDITO
                        AND    MCP.ANO = 2012
                      ) X ON MCH.NROCOMPROBANTE = X.NROCOMPROBANTE 
WHERE  MCH.ESTADO = '0'                      
COMMIT

BEGIN TRAN
UPDATE MCP SET MCP.ESTADO = '1'
--SELECT MCP.*
FROM   MCP
WHERE  MCP.ESTADO = '0'
AND    MCP.COMPROBANTE = '10'
AND    MCP.ANULADO <> 1
AND    EXISTS (SELECT * FROM MCH WHERE MCH.NROCOMPROBANTE = MCP.NROCOMPROBANTE)
AND    NOT EXISTS (SELECT * FROM MCH WHERE MCH.NROCOMPROBANTE = MCP.NROCOMPROBANTE AND MCH.ESTADO = '0')
AND    MCP.TOTALDEBITO = MCP.TOTALCREDITO
AND    MCP.ANO = 2012
COMMIT
BEGIN TRAN
UPDATE MCH SET MCH.CUENTA = Y.CUENTAFTR
FROM MCH INNER JOIN (
                     SELECT MCP.NROCOMPROBANTE NROCOMPROBANTEFTR, MCP.NOREFERENCIA NOREFERENCIAFTR, MCH.NROASIENTO NROASIENTOFTR, MCH.CUENTA CUENTAFTR, 
                            X.NROCOMPROBANTE NROCOMPROBANTENC, X.N_FACTURA N_FACTURANC, X.CUENTA CUENTANC, X.NROASIENTO NROASIENTONC
                     FROM   MCP INNER JOIN MCH ON MCP.NROCOMPROBANTE = MCH.NROCOMPROBANTE
                                INNER JOIN (
                                             SELECT X.ANO, X.MES, MCH.NROCOMPROBANTE, MCH.NROASIENTO, MCH.N_FACTURA, MCH.CUENTA
                                             FROM   MCH INNER JOIN (
                                                                     SELECT MCP.NROCOMPROBANTE, MCP.ANO, MCP.MES
                                                                     FROM   MCP
                                                                     WHERE  MCP.ESTADO = '1'
                                                                     AND    MCP.ANO = 2012
                                                                     AND    MCP.COMPROBANTE = '20'
                                                                     AND    EXISTS (SELECT * FROM MCH WHERE MCH.NROCOMPROBANTE = MCP.NROCOMPROBANTE AND MCH.CUENTA = '140906001' AND MCH.TIPO = 'CR')
                                                                     AND    MCP.ANULADO <> 1
                                                                   )  X ON MCH.NROCOMPROBANTE = X.NROCOMPROBANTE
                                             WHERE MCH.CUENTA = '140906001'                          

                                           ) X ON X.N_FACTURA = MCP.NOREFERENCIA
                     WHERE  MCP.COMPROBANTE = '10'
                     AND    LEFT(MCH.CUENTA,4) = '1409'
                  ) Y ON MCH.NROCOMPROBANTE = Y.NROCOMPROBANTENC
                     AND MCH.NROASIENTO     = Y.NROASIENTONC   

COMMIT

0114800000974315	HSJM01130000	13390148	140903001      	0198000001003787	HSJM01130000	140906001	13843939
0114800000974315	HSJM01130000	13390149	140903001      	0198000001003787	HSJM01130000	140906001	13843939

SELECT * FROM MCH 
WHERE  NROCOMPROBANTE = '0114800000974315'
AND    NROASIENTO IN ('13390148', '13390149')

SELECT * FROM MCH 
WHERE  NROCOMPROBANTE = '0198000001003787'
AND    NROASIENTO IN ('13843939')



SELECT X.ANO, X.MES, MCH.NROCOMPROBANTE, MCH.NROASIENTO, MCH.N_FACTURA, MCH.CUENTA, MCH.*
FROM   MCH INNER JOIN (
                        SELECT MCP.NROCOMPROBANTE, MCP.ANO, MCP.MES
                        FROM   MCP
                        WHERE  MCP.ESTADO = '1'
                        AND    MCP.ANO = 2012
                        AND    MCP.COMPROBANTE = '20'
                        AND    EXISTS (SELECT * FROM MCH WHERE MCH.NROCOMPROBANTE = MCP.NROCOMPROBANTE AND MCH.CUENTA = '140906001' AND MCH.TIPO = 'CR')
                        AND    MCP.ANULADO <> 1
                      )  X ON MCH.NROCOMPROBANTE = X.NROCOMPROBANTE
WHERE MCH.CUENTA = '140906001'                          

BEGIN TRAN
UPDATE MCP SET ESTADO = 2
--SELECT * FROM   MCP
WHERE  MCP.ANO = 2012
AND    MCP.MES = 9
AND    MCP.ESTADO = '1'
AND    MCP.ANULADO <> 1
COMMIT



SELECT DISTINCT ANO + MES FROM MCP WHERE ANO = '2005'

SELECT * FROM PRI WHERE ANO = '2005'

SELECT ANULADO,* FROM MCP WHERE ANO = 2005 AND MES = 6

SELECT * FROM SXT2005


SELECT MCPNROCOMPROBANTE
BEGIN TRAN
UPDATE MCP SET ESTADO = 2
--SELECT * FROM   MCP
WHERE  MCP.ANO = 2012
AND    MCP.MES = 9
AND    MCP.ESTADO = '1'
AND    MCP.ANULADO <> 1
COMMIT

UPDATE MCH SET MCH.ESTADO = 2
--SELECT MCH.ESTADO, MCP.ESTADO, MCP.ANO, MCP.MES, MCP.NROCOMPROBANTE
FROM   MCH INNER JOIN MCP ON MCH.NROCOMPROBANTE = MCP.NROCOMPROBANTE
WHERE  MCP.ESTADO = 2
AND    MCH.ESTADO = 1
AND    MCP.ANULADO <>1
AND    MCP.ANO = 2012
AND    MCP.MES = 9