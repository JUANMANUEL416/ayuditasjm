
LOC:CNSEXCEL = clip(GLO:IDSEDE)&format(fnGeneraConsecutivo(GLO:IDSEDE,'KEXCEL'),@n08)

LOC:RUTA=GETINI('RUTA','rutasoat','','.\Krystalosx.ini')&'EXPORT.xls'

LOC:SQL = 'EXEC SPK_PROCESOSOAT_EXCEL '&FNSQLFMT(GLO:PROCEDENCIA)&', '&FnSqlFmt(IN:NOREFERENCIA)&', '&FnSqlFmt(LOC:CNSEXCEL)&', '&CHR(13)&CHR(10)&|
    FNSQLFMT(IN:CNS)&', '&IN:ITEM &', '&FNSQLFMT(DPR:IDTERCERO)&', '&FNSQLFMT(DPR:IDSGSSS)
IF FNVALORVARIABLE('IDDEPURAR')='SI' AND GLO:GRUPO='PPAL'
    SETCLIPBOARD(LOC:SQL)
    STOP('Cargo Datos Export')
END
CLEAR(WDUM:RECORD)
WDUM{PROP:SQL} = loc:sql
IF FNVALORVARIABLE('IDDEPURAR')='SI' AND GLO:GRUPO='PPAL'
   SETCLIPBOARD('RellenarExcel.exe '&clip(loc:rutafsoat)&' '&clip(LOC:CNSEXCEL)&' '&clip(GLO:SERVIDOR)&' '&clip(GLO:BDNAME))
    STOP('Llamo Export')
END
RUN('RellenarExcel.exe '&clip(LOC:RUTA)&' '&clip(LOC:CNSEXCEL)&' '&clip(GLO:SERVIDOR)&' '&clip(GLO:BDNAME))

-- SOLO CONSULTA

-- ARMANDO PARAMENTROS JUAN3:16
LOC:SQL1=''
LOOP I#=1 TO LEN(LOC:SQL) BY 1
   IF LOC:SQL[I#]=''''  
      LOC:SQL1=LOC:SQL1&LOC:SQL[I#]&''''
   ELSE
      LOC:SQL1=LOC:SQL1&LOC:SQL[I#]
   END
END
CLEAR(WDUM:RECORD)
WDUM{PROP:SQL}='INSERT INTO KEXCEL_FILL(CNSEXCEL,NOMBRE,CONSULTA)'&|
    'SELECT '&FNSQLFMT(LOC:CNSEXCEL)&',''LISTADO DE CASOS POR ESTADO.xls'','''&CLIP(LOC:SQL1)&''''

CLEAR(WDUM:RECORD)
WDUM{PROP:SQL}='INSERT INTO KEXCEL_FILL(CNSEXCEL,NOMBRE,CONSULTA)'&|
    'SELECT '&FNSQLFMT(LOC:CNSEXCEL)&',''DETALLADO FACTURAS.xls'',''''&CLIP(LOC:SQL)&''''
    
    
    c:\dev10\pkrystalos\for_ms\ainicial_urg.xls 0100000070 ixsoporte\juan kasoca