IF EXISTS (SELECT NAME FROM SYSOBJECTS WHERE NAME = 'TABLESPACEUSED' AND TYPE = 'P')
BEGIN
   DROP PROCEDURE TABLESPACEUSED 
END
GO
CREATE PROCEDURE DBO.TABLESPACEUSED
AS
GO
-- CREATE THE TEMPORARY TABLE...
CREATE TABLE #TRESULTADOS
(
[NAME]   NVARCHAR(50),
[ROWS]   INT,
[RESERVED]   VARCHAR(18),
[RESERVED_INT]   INT DEFAULT(0),
[DATA]   VARCHAR(18),
[DATA_INT]   INT DEFAULT(0),
[INDEX_SIZE]   VARCHAR(18),
[INDEX_SIZE_INT]   INT DEFAULT(0),
[UNUSED]   VARCHAR(18),
[UNUSED_INT]   INT DEFAULT(0)
)
GO
-- POPULATE THE TEMP TABLE...
EXEC SP_MSFOREACHTABLE @COMMAND1=
"INSERT INTO #TRESULTADOS
([NAME],[ROWS],[RESERVED],[DATA],[INDEX_SIZE],[UNUSED])
EXEC SP_SPACEUSED '?'"
GO
-- STRIP OUT THE " KB" PORTION FROM THE FIELDS
UPDATE #TRESULTADOS SET
[RESERVED_INT] = CAST(SUBSTRING([RESERVED], 1,
CHARINDEX(' ', [RESERVED])) AS INT),
[DATA_INT] = CAST(SUBSTRING([DATA], 1,
CHARINDEX(' ', [DATA])) AS INT),
[INDEX_SIZE_INT] = CAST(SUBSTRING([INDEX_SIZE], 1,
CHARINDEX(' ', [INDEX_SIZE])) AS INT),
[UNUSED_INT] = CAST(SUBSTRING([UNUSED], 1,
CHARINDEX(' ', [UNUSED])) AS INT)
GO
-- RETURN THE RESULTS...
SELECT * FROM #TRESULTADOS -- WHERE LEN(NAME)>7
ORDER BY ROWS DESC

-- CREANDO SCRIPT PARA BORRAR DATOS
--SELECT  'ALTER TABLE '+[NAME]+' DISABLE TRIGGER ALL'+CHAR(13)+'DELETE '+[NAME]+' '+CHAR(13)+' ALTER TABLE '+[NAME]+' ENABLE TRIGGER ALL '
--FROM #TRESULTADOS
--WHERE [ROWS]>0
--ORDER BY [ROWS] ASC

--DROP TABLE #TRESULTADOS
--DROP TABLE IHISD_V177000
--DROP TABLE SALCONTD
--DROP TABLE FTRVIEJAS

TRUNCATE TABLE RPDX 
TRUNCATE TABLE RPDX2
TRUNCATE TABLE RPDX3
TRUNCATE TABLE RPHC
TRUNCATE TABLE TBALANCETERFAC
TRUNCATE TABLE AUXCUENTA
TRUNCATE TABLE NEMPFD_RUN
TRUNCATE TABLE EFTR
--TRUNCATE TABLE IHISD
--TRUNCATE TABLE API_LOG
TRUNCATE TABLE KEXCEL_FILLD
TRUNCATE TABLE KEXCEL_FILL
TRUNCATE TABLE RPAD


--RIPS -- GENERADOS -- OJO 
--TRUNCATE TABLE RRIPS_AM
--TRUNCATE TABLE RRIPS_AN
--TRUNCATE TABLE RRIPS_AP
--TRUNCATE TABLE RRIPS_AT
--TRUNCATE TABLE RRIPS_AC
--TRUNCATE TABLE RRIPS_US
--TRUNCATE TABLE RRIPS_CT
--TRUNCATE TABLE RRIPS_AD
--TRUNCATE TABLE RRIPS_AF
--TRUNCATE TABLE RRIPS_AU
--TRUNCATE TABLE RRIPS_AH

--QUITAMOS LA REFERENCIA DE LOS LOG
--ALTER TABLE [dbo].[USLOGH] DROP CONSTRAINT [FK_USLOGH_USLOGHCNSLOG]
--VOLVEMOS A CREARLA
--ALTER TABLE [dbo].[USLOGH]  WITH NOCHECK ADD  CONSTRAINT [FK_USLOGH_USLOGHCNSLOG] FOREIGN KEY([CNSLOG])
--REFERENCES [dbo].[USLOG] ([CNSLOG])
--ON UPDATE CASCADE
--GO

--TRUNCATE TABLE USLOGH
--TRUNCATE TABLE USLOG


--EXEC sp_updatestats
--exec SPKH_REINDEXAR 'TODAS'

--DROP TABLE IART_BACKUP
--DROP TABLE SER_BACKUP
--DROP TABLE PERSONAL

--DELETE USLOGH