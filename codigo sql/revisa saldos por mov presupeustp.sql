SELECT A.*,B.VALOR,A.VALOR-B.VALOR AS DIF
FROM 
(
 SELECT A.CONSECUTIVO, A.CDP,A.RP,A.RUBRO,SUM(A.VALOR-COALESCE(VLR_LIBERADO,0)) VALOR 
 FROM  PTRPD A INNER JOIN PTRP D ON   A.CONSECUTIVO=D.CONSECUTIVO AND A.CDP=D.CDP AND A.RP=D.RP 
   WHERE A.CONSECUTIVO='2021' AND A.RUBRO='21020221' AND D.ESTADO='Confirmado' 
   --AND A.RP='0100000007'
   GROUP BY A.CONSECUTIVO, A.CDP,A.RP,A. RUBRO )
   A LEFT JOIN 
 (SELECT A.CONSECUTIVO, A.CDP,A.RP,A.RUBRO,SUM(A.VALOR) VALOR 
 FROM  PTCXPD A INNER JOIN PTCXP D ON   A.CONSECUTIVO=D.CONSECUTIVO AND A.CDP=D.CDP AND A.RP=D.RP AND A.CNSCXP=D.CNSCXP
   WHERE A.CONSECUTIVO='2021' AND A.RUBRO='21020221' AND D.ESTADO='Confirmado' 
   --AND A.RP='0100000007'
   GROUP BY A.CONSECUTIVO, A.CDP,A.RP,A. RUBRO ) B ON A.CDP=B.CDP AND A.RP=B.RP AND A.CONSECUTIVO=B.CONSECUTIVO AND A.RUBRO=B.RUBRO
   WHERE A.VALOR-B.VALOR<>0

   SELECT  * FROM PTRPD  WHERE RP='0100002482' AND CONSECUTIVO='2021'
   ALTER TABLE PTRPD ENABLE TRIGGER ALL
   UPDATE PTRPD SET VLR_LIBERADO=0  WHERE RP='0100002482' AND CONSECUTIVO='2021'