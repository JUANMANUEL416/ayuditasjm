

SELECT TOP 1  * INTO #B FROM IMOVH WHERE CNSMOV='0200016549'

SELECT  * FROM IMOVH WHERE CNSMOV='0200016551' AND PCOSTO<=0

UPDATE IMOVH SET PCOSTO=1000 WHERE CNSMOV='0200016551' AND PCOSTO<=0

DELETE IMOVH WHERE CNSMOV='0200016551'

SELECT  * FROM #A WHERE ISDATE(F_VENCE)=0

UPDATE #A SET F_VENCE='28'+RIGHT(F_VENCE,LEN(F_VENCE)-2) WHERE ISDATE(F_VENCE)=0

UPDATE #B SET CNSMOV='0200016551'

SELECT IDARTICULO, COUNT(*) FROM #A 
GROUP BY IDARTICULO 
HAVING COUNT(*)>1

UPDATE  #A SET F_vENCE='30/04/2026' WHERE ISDATE(F_VENCE)=0

ALTER TABLE #A ALTER COLUMN F_VENCE DATETIME


SELECT DBO.FNK_COLUMNAS_TABLAS('IMOVH')

INSERT INTO IMOVH(CNSMOV, IDARTICULO, EXISTENCIA, CANTIDAD, CANTPEDIDA, PCOSTO, NOLOTE, NOLOTEPEDIDO, FECHAVENCE, ESTADO, IDARTICULOTF, CANTIDADTF, PCOSTOANTES, CNSTRAN, ITEM, PVENTA, USUARIO, USUARIOCONF, FECHACONF, PRIEXI, FECHAREPOSI, IDARTICULOORI, CANTIDADORI, TIENECAMBIO, DETALLE, CANT_EN_ACTIVOS, ENCXP, PIVA, VLRIVA, PDTO, VLRDTO, CNSHTX, COTIZADO, IDIMPUESTO, IDCLASE, ITFC, CNSITFC, CUENTA_FIMPDV, IDITAR, CODCUM, CAMBIADO, PCOSTOANTESMOD, USUARIOCAMBIO, IDFABRICANTE, CUENTADB, CUENTACR, IDSERVICIO, VLRIMPCONSUMO, NOPRESTACION, RENFER, USUARIOR, CANTREP, DILUYENTE, RINVIMA, SELLOCALIDAD, CAPACIDAD, ODESFERA, OIESFERA, ODCILINDRO, OICILINDRO, ODEJE, OIEJE, ODADICION, OIADICION, ODALT, OIALT, ODAVL, OIAVL, ODTLENTE, OITLENTE, ODDNP, OIDNP, ENVIADO, EXISLOTE, PCOSTOPP, VIVACOPA, VIVATCOPA, VIVATVENTA, PVENTAT)
SELECT CNSMOV, #A.IDARTICULO, 0, #A.CANTIDAD, #A.CANTIDAD, IART.PCOSTO, 'AJUSTE', #A.LOTE, #A.F_VENCE, 0, IDARTICULOTF, CANTIDADTF, PCOSTOANTES, CNSTRAN, ITEM, PVENTA, USUARIO, USUARIOCONF, FECHACONF, PRIEXI, FECHAREPOSI, IDARTICULOORI, CANTIDADORI, TIENECAMBIO, DETALLE, CANT_EN_ACTIVOS, ENCXP, PIVA, VLRIVA, PDTO, VLRDTO, CNSHTX, COTIZADO, IDIMPUESTO, IART.IDCLASE, ITFC, CNSITFC, CUENTA_FIMPDV, IART.IDITAR, IART.CODCUM, CAMBIADO, PCOSTOANTESMOD, USUARIOCAMBIO, #B.IDFABRICANTE, CUENTADB, CUENTACR, IART.IDSERVICIO, VLRIMPCONSUMO, NOPRESTACION, RENFER, USUARIOR, CANTREP, DILUYENTE, RINVIMA, SELLOCALIDAD, CAPACIDAD, ODESFERA, OIESFERA, ODCILINDRO, OICILINDRO, ODEJE, OIEJE, ODADICION, OIADICION, ODALT, OIALT, ODAVL, OIAVL, ODTLENTE, OITLENTE, ODDNP, OIDNP, ENVIADO, EXISLOTE, PCOSTOPP, VIVACOPA, VIVATCOPA, VIVATVENTA, PVENTATFROM #A INNER JOIN IART ON #A.IDARTICULO COLLATE SQL_1xCompat_CP850_CI_AS =IART.IDARTICULO,#BWHERE #A.LOTE ='2208000262'DELETE #AALTER TABLE #A ALTER COLUMN F_VENCE DATETIMEINSERT INTO #ASELECT 'MP00006-2','105','1424991','31/05/2024' UNION ALL 
SELECT 'MP005-1','16','3286787','31/03/2025' UNION ALL 
SELECT 'MP010-1','20','2201062','31/08/2024' UNION ALL 
SELECT 'MP023-2','17','83488','31/03/2025' UNION ALL 
SELECT 'MP029-1','1188','2M3465','31/10/2025' UNION ALL 
SELECT 'MP031-1','159','618Z30','31/11/2024' UNION ALL 
SELECT 'MP039-1','551','2162','28/02/2026' UNION ALL 
SELECT 'MP058-1','7','1444670','28/02/2025' UNION ALL 
SELECT 'MP076-1','51','21C775','30/06/2023' UNION ALL 
SELECT 'MP085-3','154','220700059','31/07/2025' UNION ALL 
SELECT 'MP108-1','63','CCL2680','31/08/2024' UNION ALL 
SELECT 'MP121-3','2','CD0702A','31/03/2024' UNION ALL 
SELECT 'MP124-1','69','114A04','31/01/2026' UNION ALL 
SELECT 'MP144-2','121','B2L608','30/11/2024' UNION ALL 
SELECT 'MP148-3','13','2205036','31/05/2025' UNION ALL 
SELECT 'MP149-1','3','760121','28/02/2024' UNION ALL 
SELECT 'MP151-4','49','BRC12242A','30/11/2024' UNION ALL 
SELECT 'MP158-2','5','2M3273','30/09/2024' UNION ALL 
SELECT 'MP159-1','10','2E2030','31/05/2024' UNION ALL 
SELECT 'MC003-1','342','142700121','31/10/2024' UNION ALL 
SELECT 'MC005-1','1573','3E1704','30/01/2027' UNION ALL 
SELECT 'MC006-1','806','BCL3025','31/08/2023' UNION ALL 
SELECT 'MC008-1','347','80278','31/10/2024' UNION ALL 
SELECT 'MC009-2','105','18670','30/06/2024' UNION ALL 
SELECT 'LI004-2','26','2222222','31/12/2022' UNION ALL 
SELECT 'LI006-1','13','CB23BJ5','28/02/2025' UNION ALL 
SELECT 'LI009-1','17','5B23EB3','28/02/2025' UNION ALL 
SELECT 'MI00002-1','100','TD23D106-C0R','4/06/2025' UNION ALL 
SELECT 'MI016-1','16','220707','7/07/2027' UNION ALL 
SELECT 'MI018-1','11','18J114B','30/09/2023' UNION ALL 
SELECT 'MI019-1','3','19B23B','31/01/2024' UNION ALL 
SELECT 'MI025-1','18','20220710','10/07/2027' UNION ALL 
SELECT 'MI041-1','5','EY20200526','25/05/2025' UNION ALL 
SELECT 'MI043-5','143','20230215-1','14/02/2028' UNION ALL 
SELECT 'MI056-1','3','20200505','4/02/2025' UNION ALL 
SELECT 'MI059-1','41','2222222','17/07/2027' UNION ALL 
SELECT 'MP116-1','15','230030','31/12/2024' UNION ALL 
SELECT 'MP00009-1','1','25413','31/09/2024' UNION ALL 
SELECT 'MP0034-1','2','22252','31/10/2024' UNION ALL 
SELECT 'MP0011-1','10','22I02','31/10/2024' UNION ALL 
SELECT 'MP0046-1','50','221001212','31/11/2025' UNION ALL 
SELECT 'MP0044-1','50','3305361','31/12/2025' UNION ALL 
SELECT 'MP180-1','140','602322','31/06/2024' UNION ALL 
SELECT 'CREAR','800','2978','30/09/2024' UNION ALL 
SELECT 'MP074-2','20','BCL4249','31/11/2024' UNION ALL 
SELECT 'MP077-1','50','771376','31/12/2023' UNION ALL 
SELECT 'MP0048-1','20','211622','31/07/2024' UNION ALL 
SELECT 'MP092-1','20','2E+141','31/01/2026' UNION ALL 
SELECT 'MP117-1','12','B040159','28/02/2025' UNION ALL 
SELECT 'MP128-3','40','230106','31/02/2025' UNION ALL 
SELECT 'MP132-4','20','600533A','28/02/2024' UNION ALL 
SELECT 'MP0026-1','1','22264','30/11/2025' UNION ALL 
SELECT 'MP154-2','1700','M07406','31/10/2024' UNION ALL 
SELECT 'MI0023-1','3','ST20191010','9/10/2024' UNION ALL 
SELECT 'MI033-1','59','221027','30/09/2027' UNION ALL 
SELECT 'MI013-2','1','10131222','31/12/2027' UNION ALL 
SELECT 'MI079-2','1','2208B31889','24/08/2027' UNION ALL 
SELECT 'MI0029-1','2','01114801-20','31/12/2023' UNION ALL 
SELECT 'MI00010-2 ','19','26J2101','30/09/2023' UNION ALL 
SELECT 'MI00008-1','20','01ADG024A','31/03/2024' UNION ALL 
SELECT 'MI00006-2','30','SYP1122002','30/09/2023' UNION ALL 
SELECT 'MP0021-3','2','2006157','30/06/2024' UNION ALL 
SELECT 'MI034-5','32','53500147','1/10/2027' UNION ALL 
SELECT 'MI034-3','4','215833','30/10/2024' UNION ALL 
SELECT 'MI053-1','32','10940423','31/04/2028' UNION ALL 
SELECT 'MP00010-1','2','79905','31/10/2025' UNION ALL 
SELECT 'MP051-1','2','2222222','31/12/2024' UNION ALL 
SELECT 'MP0018-1','3','2222222','31/12/2024' UNION ALL 
SELECT 'MP0013-1','1','2222222','31/12/2024' UNION ALL 
SELECT 'MP087-1','3','2222222','31/12/2024' UNION ALL 
SELECT 'MP101-1','3','4230173','22/03/2026' UNION ALL 
SELECT 'MP143-2','2','2208000262V0','30/07/2024' UNION ALL 
SELECT 'MP123-1','2','2222222','31/12/2024' UNION ALL 
SELECT 'MP022-2','10','2222222','31/12/2024'