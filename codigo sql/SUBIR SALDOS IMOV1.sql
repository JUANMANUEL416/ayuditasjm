

SELECT TOP 1  * INTO #B FROM IMOVH WHERE CNSMOV='0200016551'

SELECT  * FROM IMOVH WHERE CNSMOV='0200016787' AND PCOSTO<=0

UPDATE IMOVH SET PCOSTO=1000 WHERE CNSMOV='0200016551' AND PCOSTO<=0

DELETE IMOVH WHERE CNSMOV='0200016787'

SELECT  * FROM #A WHERE ISDATE(F_VENCE)=0

UPDATE #A SET F_VENCE='28'+RIGHT(F_VENCE,LEN(F_VENCE)-2) WHERE ISDATE(F_VENCE)=0

UPDATE #B SET CNSMOV='0200016550'

SELECT * FROM IMOVH WHERE CNSMOV='0200016551'

SELECT IART.IDSERVICIO, COUNT(*) FROM #A INNER JOIN IART ON #A.IDARTICULO=IART.IDARTICULO
GROUP BY IART.IDSERVICIO
HAVING COUNT(*)>1

DROP TABLE #C

SELECT IDSERVICIO,SUM(CONVERT(INT,#A.CANTIDAD))CANTIDAD INTO #C
FROM #A INNER JOIN IART ON #A.IDARTICULO COLLATE SQL_1xCompat_CP850_CI_AS =IART.IDARTICULO
GROUP BY IDSERVICIO

UPDATE  #A SET F_vENCE='30/04/2026' WHERE ISDATE(F_VENCE)=0

ALTER TABLE #A ALTER COLUMN F_VENCE DATETIME


SELECT DBO.FNK_COLUMNAS_TABLAS('IMOVH')

INSERT INTO IMOVH(CNSMOV, IDARTICULO, EXISTENCIA, CANTIDAD, CANTPEDIDA, PCOSTO, NOLOTE, NOLOTEPEDIDO, FECHAVENCE, ESTADO, IDARTICULOTF, CANTIDADTF, PCOSTOANTES, CNSTRAN, ITEM, PVENTA, USUARIO, USUARIOCONF, 
FECHACONF, PRIEXI, FECHAREPOSI, IDARTICULOORI, CANTIDADORI, TIENECAMBIO, DETALLE, CANT_EN_ACTIVOS, ENCXP, PIVA, VLRIVA, PDTO, VLRDTO, CNSHTX, COTIZADO, IDIMPUESTO, IDCLASE, 
ITFC, CNSITFC, CUENTA_FIMPDV, IDITAR, CODCUM, CAMBIADO, PCOSTOANTESMOD, USUARIOCAMBIO, IDFABRICANTE, CUENTADB, CUENTACR, IDSERVICIO, VLRIMPCONSUMO, NOPRESTACION, RENFER, USUARIOR, 
CANTREP, DILUYENTE, RINVIMA, SELLOCALIDAD, CAPACIDAD, ODESFERA, OIESFERA, ODCILINDRO, OICILINDRO, ODEJE, OIEJE, ODADICION, OIADICION, ODALT, OIALT, ODAVL, OIAVL, ODTLENTE, OITLENTE, 
ODDNP, OIDNP, ENVIADO, EXISLOTE, PCOSTOPP, VIVACOPA, VIVATCOPA, VIVATVENTA, PVENTAT)
SELECT CNSMOV, #A.IDSERVICIO, 0, #A.CANTIDAD, #A.CANTIDAD, 0, 'AJUSTE', NULL, NULL, 0, IDARTICULOTF, CANTIDADTF, PCOSTOANTES, CNSTRAN, ITEM, PVENTA, USUARIO, USUARIOCONF, 
FECHACONF, PRIEXI, FECHAREPOSI, IDARTICULOORI, CANTIDADORI, TIENECAMBIO, DETALLE, CANT_EN_ACTIVOS, ENCXP, PIVA, VLRIVA, PDTO, VLRDTO, CNSHTX, COTIZADO, IDIMPUESTO, NULL, 
ITFC, CNSITFC, CUENTA_FIMPDV, NULL, NULL, CAMBIADO, PCOSTOANTESMOD, USUARIOCAMBIO, #B.IDFABRICANTE, CUENTADB, CUENTACR, #A.IDSERVICIO, VLRIMPCONSUMO, NOPRESTACION, RENFER, USUARIOR, 
CANTREP, DILUYENTE, RINVIMA, SELLOCALIDAD, CAPACIDAD, ODESFERA, OIESFERA, ODCILINDRO, OICILINDRO, ODEJE, OIEJE, ODADICION, OIADICION, ODALT, OIALT, ODAVL, OIAVL, ODTLENTE, OITLENTE, 
ODDNP, OIDNP, ENVIADO, EXISLOTE, PCOSTOPP, VIVACOPA, VIVATCOPA, VIVATVENTA, PVENTAT
FROM #C #A ,#B
--INNER JOIN IART ON #A.IDSERVICIO COLLATE SQL_1xCompat_CP850_CI_AS =IART.IDSERVICIO
DELETE #A
ALTER TABLE #A ALTER COLUMN CANTIDAD VARCHAR(20)

DELETE #A
INSERT INTO #A
SELECT 'MP0000005-1','30' UNION ALL
SELECT 'MP00002-1','240' UNION ALL
SELECT 'MP00004-1','2' UNION ALL
SELECT 'MP00006-1','30' UNION ALL
SELECT 'MP00007-1','8' UNION ALL
SELECT 'MP00009-1','1' UNION ALL
SELECT 'MP00010-1','8' UNION ALL
SELECT 'MP0011-1','100' UNION ALL
SELECT 'MP0011-2','50' UNION ALL
SELECT 'MP0013-1','1' UNION ALL
SELECT 'MP0016-1','4' UNION ALL
SELECT 'MP0018-1','8' UNION ALL
SELECT 'MP0019-1','1' UNION ALL
SELECT 'MP0020-1','8' UNION ALL
SELECT 'MP0025-1','3' UNION ALL
SELECT 'MP0026-1','1' UNION ALL
SELECT 'MP0028-1','2' UNION ALL
SELECT 'MP0030-1','1' UNION ALL
SELECT 'MP0032-1','5' UNION ALL
SELECT 'MP0034-1','2' UNION ALL
SELECT 'MP0036-1','1' UNION ALL
SELECT 'MP0038-1','1' UNION ALL
SELECT 'MP004-2','900' UNION ALL
SELECT 'MP0042-1','1' UNION ALL
SELECT 'MP0046-1','50' UNION ALL
SELECT 'MP005-1','91' UNION ALL
SELECT 'MP007-1','4922' UNION ALL
SELECT 'MP008-1','22' UNION ALL
SELECT 'MP010-1','22' UNION ALL
SELECT 'MP014-1','53' UNION ALL
SELECT 'MP015-2','273' UNION ALL
SELECT 'MP016-1','30' UNION ALL
SELECT 'MP017-1','280' UNION ALL
SELECT 'MP018-3','72' UNION ALL
SELECT 'MP021-1','10' UNION ALL
SELECT 'MP022-2','20' UNION ALL
SELECT 'MP023-2','5' UNION ALL
SELECT 'MP023-3','1' UNION ALL
SELECT 'MP023-4','21' UNION ALL
SELECT 'MP025-1','2' UNION ALL
SELECT 'MP027-1','5' UNION ALL
SELECT 'MP029-1','1474' UNION ALL
SELECT 'MP031-1','600' UNION ALL
SELECT 'MP031-2','2' UNION ALL
SELECT 'MP037-2','1' UNION ALL
SELECT 'MP039-1','1447' UNION ALL
SELECT 'MP041-4','19' UNION ALL
SELECT 'MP042-3','30' UNION ALL
SELECT 'MP044-1','11' UNION ALL
SELECT 'MP048-1','18' UNION ALL
SELECT 'MP049-1','6' UNION ALL
SELECT 'MP050-2','100' UNION ALL
SELECT 'MP052-1','6' UNION ALL
SELECT 'MP055-1','2' UNION ALL
SELECT 'MP058-1','41' UNION ALL
SELECT 'MP059-1','5' UNION ALL
SELECT 'MP061-1','2' UNION ALL
SELECT 'MP061-2','10' UNION ALL
SELECT 'MP062-1','49' UNION ALL
SELECT 'MP065-2','19' UNION ALL
SELECT 'MP067-1','3' UNION ALL
SELECT 'MP068-1','9' UNION ALL
SELECT 'MP070-3','1' UNION ALL
SELECT 'MP072-1','300' UNION ALL
SELECT 'MP073-2','1' UNION ALL
SELECT 'MP074-2','15' UNION ALL
SELECT 'MP075-3','100' UNION ALL
SELECT 'MP076-1','200' UNION ALL
SELECT 'MP077-1','96' UNION ALL
SELECT 'MP078-1','12' UNION ALL
SELECT 'MP079-2','1000' UNION ALL
SELECT 'MP080-1','46' UNION ALL
SELECT 'MP081-2','10' UNION ALL
SELECT 'MP084-2','58' UNION ALL
SELECT 'MP085-2','759' UNION ALL
SELECT 'MP085-3','396' UNION ALL
SELECT 'MP086-1','3' UNION ALL
SELECT 'MP087-1','6' UNION ALL
SELECT 'MP090-2','8' UNION ALL
SELECT 'MP091-1','2' UNION ALL
SELECT 'MP091-2','3' UNION ALL
SELECT 'MP092-2','48' UNION ALL
SELECT 'MP094-1','9' UNION ALL
SELECT 'MP094-2','97' UNION ALL
SELECT 'MP094-3','2' UNION ALL
SELECT 'MP094-4','7' UNION ALL
SELECT 'MP096-1','4' UNION ALL
SELECT 'MP098-3','3' UNION ALL
SELECT 'MP098-4','5' UNION ALL
SELECT 'MP099-1','11' UNION ALL
SELECT 'MP099-2','10' UNION ALL
SELECT 'MP100-1','1' UNION ALL
SELECT 'MP100-2','228' UNION ALL
SELECT 'MP100-4','5' UNION ALL
SELECT 'MP101-1','14' UNION ALL
SELECT 'MP101-2','10' UNION ALL
SELECT 'MP102-1','20' UNION ALL
SELECT 'MP103-1','680' UNION ALL
SELECT 'MP104-2','3' UNION ALL
SELECT 'MP107-1','18' UNION ALL
SELECT 'MP108-1','146' UNION ALL
SELECT 'MP109-1','154' UNION ALL
SELECT 'MP110-1','1322' UNION ALL
SELECT 'MP111-2','46' UNION ALL
SELECT 'MP113-1','5' UNION ALL
SELECT 'MP114-1','2' UNION ALL
SELECT 'MP115-1','5' UNION ALL
SELECT 'MP115-2','2' UNION ALL
SELECT 'MP116-1','5' UNION ALL
SELECT 'MP117-1','562' UNION ALL
SELECT 'MP119-2','303' UNION ALL
SELECT 'MP120-3','480' UNION ALL
SELECT 'MP121-3','32' UNION ALL
SELECT 'MP123-1','1' UNION ALL
SELECT 'MP124-1','210' UNION ALL
SELECT 'MP125-1','21' UNION ALL
SELECT 'MP126-2','14' UNION ALL
SELECT 'MP126-3','10' UNION ALL
SELECT 'MP128-3','60' UNION ALL
SELECT 'MP129-2','20' UNION ALL
SELECT 'MP129-3','20' UNION ALL
SELECT 'MP131-1','169' UNION ALL
SELECT 'MP132-3','657' UNION ALL
SELECT 'MP132-4','31' UNION ALL
SELECT 'MP139-1','1' UNION ALL
SELECT 'MP140-1','1' UNION ALL
SELECT 'MP141-2','1012' UNION ALL
SELECT 'MP142-1','194' UNION ALL
SELECT 'MP143-2','5' UNION ALL
SELECT 'MP144-2','114' UNION ALL
SELECT 'MP145-2','13' UNION ALL
SELECT 'MP146-1','20' UNION ALL
SELECT 'MP148-2','10' UNION ALL
SELECT 'MP148-3','3' UNION ALL
SELECT 'MP149-1','8' UNION ALL
SELECT 'MP150-1','9' UNION ALL
SELECT 'MP151-4','197' UNION ALL
SELECT 'MP153-1','516' UNION ALL
SELECT 'MP153-2','8' UNION ALL
SELECT 'MP153-5','714' UNION ALL
SELECT 'MP154-1','482' UNION ALL
SELECT 'MP154-2','2087' UNION ALL
SELECT 'MP154-5','39' UNION ALL
SELECT 'MP155-3','129' UNION ALL
SELECT 'MP155-7','107' UNION ALL
SELECT 'MP157-6','1058' UNION ALL
SELECT 'MP158-1','68' UNION ALL
SELECT 'MP158-2','193' UNION ALL
SELECT 'MP164-3','6' UNION ALL
SELECT 'MP165-2','1884' UNION ALL
SELECT 'MP166-2','42' UNION ALL
SELECT 'MP173-1','453' UNION ALL
SELECT 'MP179-1','3' UNION ALL
SELECT 'MP180-1','108' UNION ALL
SELECT 'MP181-3','5' UNION ALL
SELECT 'MP182-1','19' UNION ALL
SELECT 'MP184-1','50' UNION ALL
SELECT 'MP193-1','1' UNION ALL
SELECT 'MC001-1 ','90' UNION ALL
SELECT 'MC003-1','430' UNION ALL
SELECT 'MC004-1','2' UNION ALL
SELECT 'MC004-2  ','30' UNION ALL
SELECT 'MC005-1 ','1796' UNION ALL
SELECT 'MC006-1 ','9' UNION ALL
SELECT 'MC008-1  ','417' UNION ALL
SELECT 'MC008-2  ','115' UNION ALL
SELECT 'MC009-1   ','96' UNION ALL
SELECT 'MC009-2 ','67' UNION ALL
SELECT 'LI002-3  ','25' UNION ALL
SELECT 'LI003-2 ','5' UNION ALL
SELECT 'LI004-1','50' UNION ALL
SELECT 'LI005-1  ','5' UNION ALL
SELECT 'LI006-1 ','21' UNION ALL
SELECT 'LI006-2  ','3' UNION ALL
SELECT 'LI007-1','8' UNION ALL
SELECT 'LI007-2  ','5' UNION ALL
SELECT 'LI009-1 ','36' UNION ALL
SELECT 'LI009-2 ','2' UNION ALL
SELECT 'MI0000003-1 ','1' UNION ALL
SELECT 'MI00004-1','3' UNION ALL
SELECT 'MI00007-1','2' UNION ALL
SELECT 'MI00009-1','1' UNION ALL
SELECT 'MI00009-2  ','1' UNION ALL
SELECT 'MI0011-1 ','2' UNION ALL
SELECT 'MI0011-2  ','2' UNION ALL
SELECT 'MI0012-1 ','2' UNION ALL
SELECT 'MI0013-1  ','47' UNION ALL
SELECT 'MI0014-4','1' UNION ALL
SELECT 'MI0015-1 ','1' UNION ALL
SELECT 'MI0016-2 ','4' UNION ALL
SELECT 'MI0017-1  ','4' UNION ALL
SELECT 'MI0019-1','1' UNION ALL
SELECT 'MI002-1','37' UNION ALL
SELECT 'MI0021-1','1' UNION ALL
SELECT 'MI0022-1','5' UNION ALL
SELECT 'MI0025-1','1' UNION ALL
SELECT 'MI0027-1','1' UNION ALL
SELECT 'MI0029-1','1' UNION ALL
SELECT 'MI003-1','12' UNION ALL
SELECT 'MI0031-1','1' UNION ALL
SELECT 'MI0033-1','3' UNION ALL
SELECT 'MI0035-1','1' UNION ALL
SELECT 'MI0037-1','1' UNION ALL
SELECT 'MI0039-1','1' UNION ALL
SELECT 'MI0041-1','1' UNION ALL
SELECT 'MI0043-1','1' UNION ALL
SELECT 'MI0045-1','1' UNION ALL
SELECT 'MI0047-1','1' UNION ALL
SELECT 'MI005-3','2' UNION ALL
SELECT 'MI0053-1','1' UNION ALL
SELECT 'MI0055-1','1' UNION ALL
SELECT 'MI0057-1','1' UNION ALL
SELECT 'MI0059-1','1' UNION ALL
SELECT 'MI008-1','13' UNION ALL
SELECT 'MI009-3','1' UNION ALL
SELECT 'MI010-2','3' UNION ALL
SELECT 'MI011-2','3' UNION ALL
SELECT 'MI011-3','1' UNION ALL
SELECT 'MI012-1','1' UNION ALL
SELECT 'MI016-1','16' UNION ALL
SELECT 'MI016-2','50' UNION ALL
SELECT 'MI017-2','49' UNION ALL
SELECT 'MI018-2','74' UNION ALL
SELECT 'MI019-1','14' UNION ALL
SELECT 'MI019-3','10' UNION ALL
SELECT 'MI020-2','10' UNION ALL
SELECT 'MI021-1','17' UNION ALL
SELECT 'MI025-1','145' UNION ALL
SELECT 'MI032-1','10' UNION ALL
SELECT 'MI034-2','40' UNION ALL
SELECT 'MI034-3','56' UNION ALL
SELECT 'MI034-4','40' UNION ALL
SELECT 'MI034-5','30' UNION ALL
SELECT 'MI039-1','95' UNION ALL
SELECT 'MI040-2','99' UNION ALL
SELECT 'MI040-6','17' UNION ALL
SELECT 'MI040-7','300' UNION ALL
SELECT 'MI043-5','382' UNION ALL
SELECT 'MI043-6','109' UNION ALL
SELECT 'MI047-4','2' UNION ALL
SELECT 'MI048-4','25' UNION ALL
SELECT 'MI049-4','3' UNION ALL
SELECT 'MI053-1','118' UNION ALL
SELECT 'MI053-2','150' UNION ALL
SELECT 'MI056-1','4' UNION ALL
SELECT 'MI059-1','82' UNION ALL
SELECT 'MI059-2','100' UNION ALL
SELECT 'MI060-2','1' UNION ALL
SELECT 'MI060-3','1' UNION ALL
SELECT 'MI061-1','1' UNION ALL
SELECT 'MI067-1','43' UNION ALL
SELECT 'MI068-1','47' UNION ALL
SELECT 'MI071-2','7' UNION ALL
SELECT 'MI072-1','217' UNION ALL
SELECT 'MI074-1','3' UNION ALL
SELECT 'MI077-2','3' UNION ALL
SELECT 'MI077-3','1' UNION ALL
SELECT 'MI078-1','2' UNION ALL
SELECT 'MI079-1','1' UNION ALL
SELECT 'MI079-2','1' UNION ALL
SELECT 'MI080-1','3' UNION ALL
SELECT 'MI081-1','36' UNION ALL
SELECT 'MI084-1','5' UNION ALL
SELECT 'MI085-1','6'
