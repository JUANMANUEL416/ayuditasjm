select  * from dbo.FNK_CREA_TABLA_DESDEJSON('{"PROCESO":"Nuevo","CNSFNOT":"02C00000515","CLASE":"C","TIPO":"S","N_FACTURA":"UV10060","N_CUOTA":1,"IDSERVICIO":"890284","DESCRIPCION":"CONSULTA DE PRIMERA VEZ POR ESPECIALISTA EN PSIQUIATRIA \r\n","PREFIJO":"001","IDAREA":"4100","CCOSTO":"100","CANTIDAD":1,"VR_UNITARIO":"1000","VR_TOTAL":1000,"OBSERVACION":"pruebas de soporte"}')

SELECT TOP 10 * FROM API_LOG WHERE USUARIO='JJIMENEZ' ORDER BY ITEM DESC

SELECT  * FROM VWK_FTRNDCR where N_FACTURA='UV10038'
ROLLBACK
frmvalido
FNOT

SELECT  TOP 10 * FROM FNOT WHERE CNSFNOT='02C00000515'

BEGIN TRAN 
EXEC SPQ_JSON '
{"MODELO":"FNOT_COL","METODO":"FNOT_CRUDFNOTD","PARAMETROS":{"DATOS":{"PROCESO":"Editar","CNSFNOT":"02C00000503","item":1,"CLASE":"C"}},"USUARIO":"JJIMENEZ"}
'
ROLLBACK
SELECT DESCRIPCION,  * FROM FNOTD WHERE CNSFNOT='02C00000503'

SELECT ITEM=COALESCE(MAX(ITEM),0)+1 FROM FNOTD WHERE  CNSFNOT='02C00000503' AND CLASE='C'

SELECT FNOT.CNSFNOT,FNOT.CLASE,DBO.FNK_FECHA_GRINGA(FNOT.F_NOTA)F_NOTA,TER.IDTERCERO,TER.NIT,TER.RAZONSOCIAL,FNOT.N_FACTURA,FNOT.VR_TOTAL,FNOT.PROCEDENCIA,FNOT.IDCONCEPTO,CPNT.DESCRIPCION,FNOT.OBSERVACION,FNOT.CONTABILIZADA,COALESCE(FNOT.NROCOMPROBANTE,'')NROCOMPROBANTE,COALESCE(FNOT.FACTE,0)FACTE,FNOT.CERRADA,FNOT.ESTADO,FNOT.CONCEPTO,FNOT.TIPOCONCEPTO,FNOT.VALORCONCEPTO,FNOT.DETGENERADOS,VK.SALDO ,DATOS = (             SELECT  CNSFNOT,CLASE,ITEM,IDSERVICIO,DESCRIPCION,CANTIDAD,CAST(VR_UNITARIO AS VARCHAR(20))VR_UNITARIO,CAST(VR_TOTAL AS VARCHAR(20))VR_TOTAL,COALESCE(DBO.FNK_RTF(FNOTD.OBSERVACION),'')   AS OBS FROM FNOTD             WHERE FNOTD.CNSFNOT = FNOT.CNSFNOT             FOR JSON PATH )  FROM [dbo].[FNOT] INNER JOIN TER ON FNOT.IDTERCERO=TER.IDTERCERO  LEFT JOIN CPNT ON FNOT.IDCONCEPTO=CPNT.CODIGO LEFT JOIN VWK_FTRNDCR VK ON FNOT.N_FACTURA=VK.N_FACTURA  WHERE (TER.RAZONSOCIAL LIKE '%%%%' OR CNSFNOT LIKE '%%%%') AND   FNOT.CERRADA = 0 AND FNOT.ESTADO='O' AND FNOT.APLICADAA<>'P'   ORDER BY FNOT.F_NOTA DESC OFFSET (1-1)*10 ROWS  FETCH NEXT 10 ROWS ONLY 


SELECT  * FROM VWK_FTRNDCR WHERE N_FACTURA='UV10060'

@N_FACTURA=UV10060 @CNSCXC=0200000127 VALOR     40140
SELECT * FROM FCXCD WHERE N_FACTURA='UV10060' AND CNSCXC='0200000127' AND SALDONETO<=40140