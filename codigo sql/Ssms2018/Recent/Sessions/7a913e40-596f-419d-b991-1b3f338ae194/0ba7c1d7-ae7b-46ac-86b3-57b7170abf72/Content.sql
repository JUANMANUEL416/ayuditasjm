SELECT TOP 10 * FROM API_LOG WHERE USUARIO='JJIMENEZ' ORDER BY ITEM DESC


SELECT CIT.CONSECUTIVO,DBO.FNK_FECHA_GRINGA(CIT.FECHA)FECHA,AFI.TIPO_DOC,AFI.DOCIDAFILIADO,AFI.NOMBREAFI,CIT.IDMEDICO,MED.NOMBRE,MES.DESCRIPCION,CIT.IDSERVICIO,SER.DESCSERVICIO,COALESCE(CIT.VALORTOTAL,0)VALORTOTAL,COALESCE(CIT.VALORCOPAGO,0)VALORCOPAGO,(COALESCE(CIT.VALORTOTAL,0)-COALESCE(CIT.VALORCOPAGO,0))VLR_EXCEDENTE  FROM [dbo].[CIT] INNER JOIN  AFI ON CIT.IDAFILIADO=AFI.IDAFILIADO INNER JOIN  MED ON CIT.IDMEDICO=MED.IDMEDICO INNER JOIN  SER ON CIT.IDSERVICIO=SER.IDSERVICIO LEFT JOIN  MES ON CIT.IDEMEDICA=MES.IDEMEDICA WHERE (MED.NOMBRE LIKE '%%%%' OR CONSECUTIVO LIKE '%%%%' OR AFI.NOMBREAFI LIKE '%%%%') AND 1=1  ORDER BY CONSECUTIVO DESC  OFFSET (1-1)*10 ROWS  FETCH NEXT 10 ROWS ONLY 

<i class="fa-solid fa-print"></i>
<i class="fa-solid fa-file-invoice-dollar"></i>

UPDATE CIT SET VALORTOTAL=120 WHERE COALESCE(VALORTOTAL,0)<=0  AND IDAFILIADO IS NOT NULL

SELECT TIPOFIN, * FROM FTR WHERE N

SELECT CIT.CONSECUTIVO,DBO.FNK_FECHA_GRINGA(CIT.FECHA)FECHA,AFI.TIPO_DOC,AFI.DOCIDAFILIADO,AFI.NOMBREAFI,CIT.IDMEDICO,MED.NOMBRE,MES.DESCRIPCION,CIT.IDSERVICIO,SER.DESCSERVICIO,COALESCE(CIT.VALORTOTAL,0)VALORTOTAL,COALESCE(CIT.VALORCOPAGO,0)VALORCOPAGO,(COALESCE(CIT.VALORTOTAL,0)-COALESCE(CIT.VALORCOPAGO,0))VLR_EXCEDENTE,COALESCE(CIT.FACTURADA,0) FACTURADA,CIT.N_FACTURA  FROM [dbo].[CIT] INNER JOIN  AFI ON CIT.IDAFILIADO=AFI.IDAFILIADO INNER JOIN  MED ON CIT.IDMEDICO=MED.IDMEDICO INNER JOIN  SER ON CIT.IDSERVICIO=SER.IDSERVICIO LEFT JOIN  MES ON CIT.IDEMEDICA=MES.IDEMEDICA WHERE (MED.NOMBRE LIKE '%%%%' OR CONSECUTIVO LIKE '%%%%' OR AFI.NOMBREAFI LIKE '%%%%') AND  COALESCE(CIT.CUMPLIDA,0)=1 AND CIT.IDAFILIADO IS NOT NULL AND CONVERT(DATE,CIT.FECHA)>='2024-10-16' AND CONVERT(DATE,CIT.FECHA)<='2024-10-16'  ORDER BY CONSECUTIVO DESC  OFFSET (1-1)*10 ROWS  FETCH NEXT 10 ROWS ONLY

UPDATE CIT SET FACTURADA=0,N_FACTURA=NULL WHERE N_FACTURA LIKE 'B%'

select  * from KPAGE ORDER BY IDKPAGE DESC

SELECT * FROM AUTD

SELECT  * FROM UBEQ

SELECT SYS_ComputerName, * FROM USUSU WHERE USUARIO='JJIMENEZ'

SELECT * FROM CIT WHERE IDAFILIADO IS NOT NULL AND FECHA>=GETDATE()-1

SELECT ROW_NUMBER() OVER(ORDER  BY AUTD.IDAUT,AUTD.NO_ITEM  ASC)ID, AUT.PREFIJO,PRE.NOM_PREFIJO,AUTD.NO_ITEM,AUTD.IDAUT,AUTD.IDSERVICIO,SER.DESCSERVICIO,AUTD.CANTIDAD,AUTD.VALOR,AUTD.VALOREXCEDENTE,AUTD.N_FACTURA   FROM [dbo].[AUTD] INNER JOIN  AUT ON AUTD.IDAUT=AUT.IDAUT INNER JOIN SER ON AUTD.IDSERVICIO=SER.IDSERVICIO  INNER JOIN PRE ON AUT.PREFIJO=PRE.PREFIJO WHERE (AUT.PREFIJO LIKE '%%%%') AND  AUT.CONSECUTIVOCIT='010000001554' AND COALESCE(AUTD.GENERADO,0)=1 AND CIT.CUMPLIDA=1  ORDER BY AUTD.IDAUT,AUTD.NO_ITEM  ASC OFFSET (1-1)*10 ROWS  FETCH NEXT 10 ROWS ONLY 
COMMIT
ROLLBACK
BEGIN TRAN 
EXEC SPQ_JSON '{"MODELO":"FTR_PERU","METODO":"FACTURAR_CITAUT","PARAMETROS":{"CONSECUTIVO":"010000001227"},"USUARIO":"JJIMENEZ"}'

			SELECT N_FACTURA,  FACTURADA =CASE WHEN FACTURADA=1 AND COALESCE(N_FACTURA,'')='' THEN 0 ELSE FACTURADA END,  FACTURABLE = FACTURABLE,
				IDTERCERO = IDTERCEROCA,  IDPLAN = CIT.IDPLAN,
				IDAFILIADO = CIT.IDAFILIADO, DESCUENTO = DESCUENTO, TIPODTO = TIPODTO, 
				CCOSTO=CCOSTO, IDTERCERO1 =IDTERCEROCA, SOAT = SOAT,
				CNSHACTRAN = CNSHACTRAN 
			FROM    CIT INNER JOIN AFI ON AFI.IDAFILIADO=CIT.IDAFILIADO WHERE CONSECUTIVO = '010000001554'

         UPDATE CIT SET FACTURADA= NULL,N_FACTURA=NULL  WHERE CONSECUTIVO = '010000001227'
         UPDATE AUTD SET FACTURADA= NULL,N_FACTURA=NULL  WHERE N_FACTURA = 'F002-00000016'
         UPDATE AUT SET FACTURADA= NULL,N_FACTURA=NULL  WHERE N_FACTURA = 'F002-00000016'

         SELECT VALORCOPAGO,VALORTOTAL, * FROM CIT WHERE CONSECUTIVO='010000001225'

         SELECT IDSEDE,FACTEP,ULRPTAAPI,NROCOMPROBANTE, * FROM FTR WHERE N_FACTURA ='F002-00000013'         
         SELECT  * FROM FTRD WHERE N_FACTURA ='F002-00000013'

         SELECT 120-35

         SELECT  * FROM USUSU WHERE USUARIO='JJIMENEZ'

         UPDATE  USUSU SET IDSEDE='01' WHERE USUARIO='JJIMENEZ'

         SELECT IDSEDE, * FROM UBEQ

         UPDATE FTR SET IDFORMATO='PE03' WHERE N_FACTURA LIKE 'F%'

         UPDATE PPT SET IDFORFTRCIT='PE03'


         UPDATE CIT SET FACTURADA=0 WHERE N_FACTURA IS NULL AND IDAFILIADO IS NOT NULL

         SELECT 85/1.18

         SELECT  * FROM FTRD WHERE N_FACTURA LIKE 'F%'

         UPDATE USVGS SET DATO='PE03' WHERE IDVARIABLE='IDFORMATOFTR'

         UPDATE FTR SET IDSEDE='01' WHERE IDSEDE IS NULL

         EXEC SPQ_JSON '{"MODELO":"FTR_IMPRESION","METODO":"DATOSFTR","PARAMETROS":{"N_FACTURA":"F002-00000009"},"USUARIO":"JJIMENEZ"}'


         SELECT ROW_NUMBER() OVER(ORDER  BY AUTD.IDAUT,AUTD.NO_ITEM  ASC)ID, AUT.PREFIJO,PRE.NOM_PREFIJO,AUTD.NO_ITEM,AUTD.IDAUT,AUTD.IDSERVICIO,SER.DESCSERVICIO,AUTD.CANTIDAD,AUTD.VALOR,(AUTD.VALOR*AUTD.CANTIDAD)SUBTOTAL,AUTD.VALORCOPAGO,AUTD.VALOREXCEDENTE,AUTD.N_FACTURA   FROM [dbo].[AUTD] INNER JOIN  AUT ON AUTD.IDAUT=AUT.IDAUT INNER JOIN SER ON AUTD.IDSERVICIO=SER.IDSERVICIO  INNER JOIN PRE ON AUT.PREFIJO=PRE.PREFIJO WHERE (AUT.PREFIJO LIKE '%%%%') AND  AUT.CONSECUTIVOCIT='010000001225' AND COALESCE(AUTD.GENERADO,0)=0 AND COALESCE(AUTD.GENERADO,0)=0   ORDER BY AUTD.IDAUT,AUTD.NO_ITEM  ASC OFFSET (1-1)*10 ROWS  FETCH NEXT 10 ROWS ONLY 


         SELECT  * FROM FTRAPILOG WHERE N_FACTURA='F002-00000017'

         SELECT  * FROM FNPAG ORDER BY ID DESC


         SELECT IDSEDE,FACTEP,ULRPTAAPI,NROCOMPROBANTE,VIVA, * FROM FTR WHERE N_FACTURA ='F002-00000016'         
         SELECT  * FROM FTRD WHERE N_FACTURA ='F002-00000016'

 UPDATE FTRD SET VLRIMPUESTO=((VLR_SERVICI-COALESCE(VLR_COPAGOS,0))/(1+(PIVA/100))),
   VIVA=(VLR_SERVICI-COALESCE(VLR_COPAGOS,0))-((VLR_SERVICI-COALESCE(VLR_COPAGOS,0))/(1+(PIVA/100)))
   WHERE COALESCE(PIVA,0)>0
   AND N_FACTURA ='F002-00000016'

         EXEC SPQ_JSON '{"MODELO":"FTR_IMPRESION","METODO":"DATOSFTR","PARAMETROS":{"N_FACTURA":"F002-00000017"},"USUARIO":"JJIMENEZ"}'

         SELECT 233.27/1.18

         SELECT 1+(PIVA/100), VLR_AFECTO=SUM(COALESCE(VLRIMPUESTO,0)),SUM(VIVA) ,
         VLR_INAFECTO=SUM(CASE WHEN COALESCE(PIVA,0)=0 THEN (VLR_SERVICI-COALESCE(VLR_COPAGOS,0)) ELSE 0 END)
         FROM FTRD 
         WHERE FTRD.N_FACTURA='F002-00000016'
         AND COALESCE(PAQUETE,0)<>2
         GROUP BY PIVA

         SELECT ITEM=CONVERT(varchar(3),N_CUOTA),CANTIDAD=CONVERT(varchar(4),CONVERT(INT,CEILING(FTRD.CANTIDAD))),
                VALOR1=CONVERT(VARCHAR(20),CONVERT(DECIMAL(14,4),COALESCE(VALOR,0))),
                VALOR2=CONVERT(VARCHAR(20),CONVERT(DECIMAL(14,4),COALESCE(VALOR,0)+COALESCE(VIVA,0))),
                VALOR3=CONVERT(VARCHAR(20),CONVERT(DECIMAL(14,2),ROUND(((COALESCE(VLR_SERVICI,0))),2))),
                VALOR4=CONVERT(VARCHAR(20),CONVERT(DECIMAL(14,2),COALESCE(FTRD.VLR_COPAGOS,0))),
                VALOR5=CONVERT(VARCHAR(20),CONVERT(INT,COALESCE(PIVA,0))),
                VALOR6=CASE WHEN COALESCE(VIVA,0)>0 THEN  CONVERT(VARCHAR(20),CONVERT(DECIMAL(14,2),COALESCE(VIVA,0)*FTRD.CANTIDAD,0)) ELSE '0.00' END,
                --VALOR7=CONVERT(VARCHAR(20),CONVERT(DECIMAL(14,2),ROUND((COALESCE(VALOR,0)*COALESCE(FTRD.CANTIDAD,0))+CASE WHEN COALESCE(VIVA,0)>0 THEN VIVA ELSE 0 END -CASE WHEN COALESCE(FTRD.VLR_COPAGOS,0)>0 THEN FTRD.VLR_COPAGOS ELSE 0 END ,2))),
                VALOR7=CONVERT(VARCHAR(20),CONVERT(DECIMAL(14,2),CASE WHEN COALESCE(VIVA,0)>0 THEN VLRIMPUESTO ELSE VALOR END)),
				 --   ANEXO= dbo.FNK_LIMPIATEXTO(CASE WHEN PROCEDENCIAFTR='FINANCIERO' THEN FTRD.ANEXO ELSE CASE WHEN COALESCE(SER.DESCRIPCION_CUPS,'')='' THEN SER.DESCSERVICIO ELSE SER.DESCRIPCION_CUPS END END,'0-9 A-Z'), 
                REFERENCIA=dbo.FNK_LIMPIATEXTO(COALESCE(SER.CODCUPS,FTRD.REFERENCIA),'0-9 A-Z '),
                AFECTA=CASE WHEN COALESCE(PIVA,0)>0 AND COALESCE(VIVA,0)>0 THEN 1 ELSE 0 END
         FROM FTRD LEFT JOIN SER ON FTRD.REFERENCIA=SER.IDSERVICIO
         WHERE N_FACTURA='F002-00000017' 
         AND N_CUOTA=1

         EXEC SPK_GENERA_JSON_PERU_FTR_INTEGRA 'F002-00000017'

         SELECT * FROM FTRD
            WHERE N_FACTURA='F002-00000017' 
         AND N_CUOTA=1