CREATE OR ALTER PROCEDURE DBO.SPQ_SELKRY @JSON NVARCHAR(MAX)
	WITH ENCRYPTION
AS
DECLARE @PARAMETROS NVARCHAR(MAX), @MODELO VARCHAR(100), @METODO VARCHAR(100), @USUARIO VARCHAR(12), @GRUPO VARCHAR(8), @SYS_COMPUTERNAME VARCHAR(254), @SEDE 
	VARCHAR(5), @A INT, @IDAFILIADO VARCHAR(20), @TIPO_DOC VARCHAR(3), @DOCIDAFILIADO VARCHAR(20), @ESTADO VARCHAR(12), @WHERES VARCHAR(2000), @QUERY VARCHAR(8000)

BEGIN
	SET LANGUAGE Spanish;
	SELECT @A = ISJSON(@JSON)
	IF @A = 0
	BEGIN
		RAISERROR ('Json: Formato Erroneo', 16, 1)
		RETURN
	END
	SELECT *
	INTO #JSON
	FROM OPENJSON(@json) WITH (MODELO VARCHAR(100) '$.MODELO', METODO VARCHAR(100) '$.METODO', USUARIO VARCHAR(12) '$.USUARIO', PARAMETROS NVARCHAR(MAX) AS JSON)

	SELECT @MODELO = MODELO, @METODO = METODO, @PARAMETROS = PARAMETROS, @USUARIO = USUARIO
	FROM #JSON

	--DEFINICION DE TABLA DE ERRORES
	DECLARE @TBLERRORES TABLE (ERROR VARCHAR(200));

	-- TOMA DEL GRUPO, SYS_COMPUTERNAME, SEDE   DE ACUERDO AL USUARIO
	PRINT 'USUARIO:' + @USUARIO

	SELECT @GRUPO = DBO.FNK_DESCIFRAR(GRUPO) FROM USUSU WHERE USUARIO = @USUARIO

	SELECT @SYS_COMPUTERNAME = SYS_COMPUTERNAME FROM USUSU WHERE USUARIO = @USUARIO

	SELECT @SEDE = IDSEDE FROM UBEQ WHERE SYS_ComputerName = @SYS_COMPUTERNAME

	SELECT @WHERES = WHERES FROM OPENJSON(@PARAMETROS) WITH (WHERES VARCHAR(2000) '$.WHERES')

	IF @METODO = 'AFI'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 
				'SELECT IDAFILIADO value ,NOMBREAFI label ,IDAFILIADO, TIPO_DOC, DOCIDAFILIADO ,EDAD , IDALTERNA
							FROM   AFI  WHERE  ' +  @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT IDAFILIADO value, NOMBREAFI label, IDAFILIADO, TIPO_DOC, DOCIDAFILIADO, EDAD, IDALTERNA FROM AFI
		RETURN
	END
	IF @METODO = 'CAU'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT IDCAUSAL value, DESCCAUSAL label
							FROM   CAU  WHERE  ' + @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT IDCAUSAL value, DESCCAUSAL label FROM CAU
		RETURN
	END
	IF @METODO = 'PAIS'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT IDPAIS value, NOMBRE label FROM PAIS
							WHERE ' + @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT IDPAIS value, NOMBRE label FROM PAIS
		RETURN
	END
	IF @METODO = 'TER'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT IDTERCERO value, RAZONSOCIAL label FROM TER WHERE ' + @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT IDTERCERO value, RAZONSOCIAL label FROM TER
		RETURN
	END
	IF @METODO = 'TERCONTRA' --Contratante Peru AC
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT DOCUMENTO value, NOMBRE label FROM TERCONTRA WHERE ' + @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT DOCUMENTO value, NOMBRE label FROM TERCONTRA
		RETURN
	END
	IF @METODO = 'PLN'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT PLN.IDPLAN value, CONCAT(PLN.IDPLAN,'' - '', PLN.DESCPLAN) label FROM PLN
							WHERE ESTADO=''Activo'' AND ' +  @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT IDPLAN value, CONCAT (PLN.IDPLAN, ' - ', PLN.DESCPLAN) label FROM PLN
		RETURN
	END
	IF @METODO = 'MPE'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT IDPESPECIAL value, CONCAT(IDPESPECIAL,'' - '',DESCESPECIAL) label FROM MPE WHERE ' + @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT IDPESPECIAL value, CONCAT (IDPESPECIAL, ' - ', DESCESPECIAL) label FROM MPE
		RETURN
	END
	IF @METODO = 'PROT'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT ID value, DESCRIPCION label FROM PROT WHERE ' + @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT ID value, DESCRIPCION label FROM PROT
		RETURN
	END
	IF @METODO = 'PROTD'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY =  'SELECT ID value, SER.DESCSERVICIO label FROM PROTD
						INNER JOIN SER ON PROTD.IDSERVICIO = SER.IDSERVICIO WHERE ' + @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT ID value, SER.DESCSERVICIO label FROM PROTD INNER JOIN SER ON PROTD.IDSERVICIO = SER.IDSERVICIO
		RETURN
	END
	IF @METODO = 'GES' --AC 20221122
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT ID value, NOMBRE label, CLASE FROM GES WHERE ' + @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT ID value, NOMBRE label, CLASE FROM GES
		RETURN
	END
	IF @METODO = 'TALR' --AC 20221122
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT IDALERTA value, DESCALTERTA label FROM TALR WHERE ' + @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT IDALERTA value, DESCALTERTA label FROM TALR
		RETURN
	END
	IF @METODO = 'JRQ' --AC 20231020
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT IDJERARQUIA value, NOMBRE label FROM JRQ WHERE ' + @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT IDJERARQUIA value, NOMBRE label FROM JRQ
		RETURN
	END
	IF @METODO = 'IGEN' --AC 20231020
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT IDGENERICO value, DESCRIPCION label FROM IGEN WHERE ' + @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT IDGENERICO value, DESCRIPCION label FROM IGEN
		RETURN
	END
	IF @METODO = 'CLF' --AC 20231020
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT CLASIFICADOR value, DESCRIPCION label FROM CLF WHERE ' + @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT CLASIFICADOR value, DESCRIPCION label FROM CLF
		RETURN
	END
	IF @METODO = 'RIPS_CP' --AC 20231020
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'ENTRE'

			SELECT @QUERY = 'SELECT IDCONCEPTORIPS value, DESCRIPRIPS label FROM RIPS_CP
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDCONCEPTORIPS value, DESCRIPRIPS label
			FROM RIPS_CP

		RETURN
	END

	IF @METODO = 'FIMP' --AC 20231020
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'ENTRE'

			SELECT @QUERY = 'SELECT IDIMPUESTO value, DESCRIPCION label FROM FIMP
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDIMPUESTO value, DESCRIPCION label
			FROM FIMP

		RETURN
	END

	IF @METODO = 'FIMPD' --AC 20231020
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'ENTRE'

			SELECT @QUERY = 'SELECT IDCLASE value, DESCRIPCION label,IDIMPUESTO  FROM FIMPD
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDCLASE value, DESCRIPCION label, IDIMPUESTO
			FROM FIMPD

		RETURN
	END

	IF @METODO = 'LSEC' --AC 20231020
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'ENTRE'

			SELECT @QUERY = 'SELECT IDSECCION value, DESCRIPCION label,AMBITO  FROM LSEC
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDSECCION value, DESCRIPCION label, AMBITO
			FROM LSEC

		RETURN
	END

	IF @METODO = 'LPLA' --AC 20231020
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'ENTRE'

			SELECT @QUERY = 'SELECT IDPLANILLA value, DESCRIPCION label  FROM LPLA
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDPLANILLA value, DESCRIPCION label
			FROM LPLA

		RETURN
	END

	IF @METODO = 'LMUE' --AC 20231020
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'ENTRE'

			SELECT @QUERY = 'SELECT IDMUESTRA value, DESCRIPCION label  FROM LMUE
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDMUESTRA value, DESCRIPCION label
			FROM LMUE

		RETURN
	END

	IF @METODO = 'CUPS' --AC 20231020
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'ENTRE'

			SELECT @QUERY = 'SELECT ID value, DESCRIPCION label  FROM CUPS
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT ID value, DESCRIPCION label
			FROM CUPS

		RETURN
	END

	IF @METODO = 'TAR' --AC 20231021
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'ENTRE'

			SELECT @QUERY = 'SELECT IDTARIFA value, DESCTARIFA label  FROM TAR
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDTARIFA value, DESCTARIFA label
			FROM TAR

		RETURN
	END

	IF @METODO = 'CUE' --AC 20231103
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'ENTRE'

			SELECT @QUERY = 'SELECT  CUENTA value,CONCAT(CUENTA,''-'', NOMCUENTA) label, TIPO, ESTADO  FROM CUE
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT CUENTA value, NOMCUENTA label, TIPO, ESTADO
			FROM CUE

		RETURN
	END

	IF @METODO = 'CIU'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'ENTRE'

			SELECT @QUERY = 'SELECT CIUDAD value, NOMBRE label FROM CIU
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT CIUDAD value, NOMBRE label
			FROM CIU

		RETURN
	END

	IF @METODO = 'DEP' --AC 20221109
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'ENTRE'

			SELECT @QUERY = 'SELECT DPTO value, NOMBRE label FROM DEP
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT DPTO value, NOMBRE label
			FROM DEP

		RETURN
	END

	IF @METODO = 'CIUB'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 'SELECT IDBARRIO value ,NOMBRE label
							FROM  CIUB 
							WHERE ' + @WHERES

			PRINT @QUERY

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDBARRIO value, NOMBRE label
			FROM CIUB
	END

	IF @METODO = 'KUNG' --AC 20221109
	BEGIN
		PRINT @WHERES

		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 'SELECT CODUNG value ,DESCRIPCION label
							FROM  KUNG 
							WHERE ' + @WHERES

			PRINT @QUERY

			EXEC (@QUERY)
		END
		ELSE
			SELECT CODUNG value, DESCRIPCION label
			FROM KUNG
	END

	IF @METODO = 'OCU'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 'SELECT OCUPACION value ,DESCRIPCION label
							FROM   OCU 
							WHERE ' + @WHERES

			PRINT @QUERY

			EXEC (@QUERY)
		END
		ELSE
			SELECT OCUPACION value, DESCRIPCION label
			FROM OCU

		RETURN
	END

	IF @METODO = 'VWK_TEXCA'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 
				'SELECT VWK_TEXCA.IDTERCERO value ,VWK_TEXCA.RAZONSOCIAL label, VWK_TEXCA.IDTERCERO, VWK_TEXCA.RAZONSOCIAL, TER.ENVIODICAJA, VWK_TEXCA.IDCATEGORIA, TER.IDALTERNA2
							FROM   VWK_TEXCA INNER JOIN TER ON VWK_TEXCA.IDTERCERO = TER.IDTERCERO 
							WHERE  VWK_TEXCA.ESTADO=''Activo'' AND COALESCE(VWK_TEXCA.RAZONSOCIAL,'''')<>'''' AND VWK_TEXCA.IDCATEGORIA=''CON''' 
				+ ' AND ' + @WHERES

			PRINT @QUERY

			EXEC (@QUERY)
		END
		ELSE
			SELECT VWK_TEXCA.IDTERCERO value, VWK_TEXCA.RAZONSOCIAL label, VWK_TEXCA.IDTERCERO, VWK_TEXCA.RAZONSOCIAL, TER.ENVIODICAJA, VWK_TEXCA.IDCATEGORIA, 
				TER.IDALTERNA2
			FROM VWK_TEXCA
			INNER JOIN TER ON VWK_TEXCA.IDTERCERO = TER.IDTERCERO
			WHERE VWK_TEXCA.ESTADO = 'Activo' AND COALESCE(VWK_TEXCA.RAZONSOCIAL, '') <> '' AND VWK_TEXCA.IDCATEGORIA = 'CON'

		RETURN
	END

	IF @METODO = 'VWK_TEXCA2'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 
				'SELECT DISTINCT  IDTERCERO value ,RAZONSOCIAL label
							FROM   VWK_TEXCA 
							WHERE  ESTADO=''Activo'' AND COALESCE(RAZONSOCIAL,'''')<>'''' AND ' 
				+ @WHERES

			PRINT @QUERY

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDTERCERO value, RAZONSOCIAL label
			FROM VWK_TEXCA
			WHERE ESTADO = 'Activo' AND COALESCE(RAZONSOCIAL, '') <> ''

		RETURN
	END

	IF @METODO = 'VWK_PPT'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 'SELECT IDPLAN value ,CONCAT(IDPLAN,'' - '',DESCPLAN) label
							FROM   VWK_PPT 
							WHERE  ' + @WHERES + 
				' ORDER BY DESCPLAN'

			PRINT @QUERY

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDPLAN value, CONCAT (IDPLAN, ' - ', DESCPLAN) label
			FROM VWK_PPT
			ORDER BY DESCPLAN

		RETURN
	END

	IF @METODO = 'HTAD'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 'SELECT TIPOADM value ,DESCRIPCION label ,TIPOATENCION ,REQHABCAMA
							FROM   HTAD 
							WHERE  ' + @WHERES

			PRINT @QUERY

			EXEC (@QUERY)
		END
		ELSE
			SELECT TIPOADM value, DESCRIPCION label, TIPOATENCION
			FROM HTAD

		RETURN
	END

	IF @METODO = 'PAT'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT IDPATOLOGIA value ,DESCRIPCION label FROM PAT WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDPATOLOGIA value, DESCRIPCION label
			FROM PAT

		RETURN
	END

	IF @METODO = 'MDX'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 'SELECT IDDX value ,CONCAT(MDX.IDDX, '' - '' ,MDX.DESCRIPCION) label
							FROM   MDX 
							WHERE  ' + @WHERES

			PRINT @QUERY

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDDX value, CONCAT (MDX.IDDX, ' - ', MDX.DESCRIPCION) label
			FROM MDX

		RETURN
	END

	IF @METODO = 'MED'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 
				'SELECT MED.IDMEDICO value, CONCAT(MED.IDMEDICO,'' - '',MED.NOMBRE) label , MEDS.IDSEDE SEDE
							FROM   MED 
							LEFT JOIN MEDS ON MED.IDMEDICO = MEDS.IDMEDICO
							WHERE ' 
				+ @WHERES + ' AND MED.ESTADO = ''Activo''' --20250718 -- STORRES -- SE AGREGA CONDICION QUE SOLO SEAN LOS MEDICOS ACTIVOS

			--PRINT @QUERY
			EXEC (@QUERY)
		END
		ELSE
			SELECT MED.IDMEDICO value, CONCAT (MED.IDMEDICO, ' - ', MED.NOMBRE) label, MEDS.IDSEDE SEDE
			FROM med
			LEFT JOIN MEDS ON MED.IDMEDICO = MEDS.IDMEDICO
         WHERE MED.ESTADO = 'Activo' --20250718 -- STORRES -- SE AGREGA CONDICION QUE SOLO SEAN LOS MEDICOS ACTIVOS
		RETURN
			--	  SELECT  * FROM MED
	END

	IF @METODO = 'VEH'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 'SELECT CONVERT(VARCHAR,ID) value ,NOMBRE label 
							FROM   VEH 
							WHERE  ' + @WHERES

			PRINT @QUERY

			EXEC (@QUERY)
		END
		ELSE
			SELECT CONVERT(VARCHAR, ID) value, NOMBRE label, CLASE
			FROM VEH

		RETURN
	END

	IF @METODO = 'PLACA'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 'SELECT CONVERT(VARCHAR,ID) value ,PLACA label 
							FROM   VEH 
							WHERE  ' + @WHERES

			PRINT @QUERY

			EXEC (@QUERY)
		END
		ELSE
			SELECT CONVERT(VARCHAR, ID) value, PLACA label, CLASE
			FROM VEH

		RETURN
	END

	IF @METODO = 'VEHICULO'
	BEGIN
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 
				'SELECT  VEHB.ID value,VEH.NOMBRE label  FROM VEHB
							INNER JOIN USUSU ON VEHB.CONDUCTOR =  USUSU.USUARIO
							INNER JOIN VEH ON VEHB.IDVEH =  VEH.ID
		
							WHERE  ' 
				+ @WHERES

			PRINT @QUERY

			EXEC (@QUERY)
		END

		RETURN
	END

	IF @METODO = 'VEHB'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 'SELECT CONVERT(VARCHAR,ID ) value ,CONVERT(VARCHAR(10),VEHB.FECHA,103) label
							FROM   VEHB 
							WHERE  ' + @WHERES + 
				'
							AND    FECHA >= CONVERT(DATE,GETDATE())'

			PRINT @QUERY

			EXEC (@QUERY)
		END
		ELSE
			SELECT ID value, CONVERT(VARCHAR(10), VEHB.FECHA, 103) label
			FROM VEHB
			WHERE FECHA >= CONVERT(DATE, GETDATE())

		RETURN
	END

	IF @METODO = 'TGEN'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 'SELECT CODIGO value ,DESCRIPCION label ,DATO1, cast(valor1 as bit) as sector
							FROM   TGEN
							WHERE  ' + @WHERES + 
				'ORDER BY DESCRIPCION ASC'

			PRINT @QUERY

			EXEC (@QUERY)
		END

		RETURN
	END

	IF @METODO = 'PPTRECLAMOS'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 
				'SELECT DISTINCT PPT.IDTERCERO, value ,TER.RAZONSOCIAL label 
							FROM   PPT INNER JOIN TER ON PPT.IDTERCERO = TER.IDTERCERO
										INNER JOIN TEXCA ON TER.IDTERCERO     = TEXCA.IDTERCERO 
														AND TEXCA.IDCATEGORIA = ''CON''
							WHERE  PPT.ENRECLAMOS = 1 AND    PPT.ESTADO     = ''Activo''' 
				+ @WHERES

			PRINT @QUERY

			EXEC (@QUERY)
		END
		ELSE
			SELECT DISTINCT PPT.IDTERCERO value, TER.RAZONSOCIAL label
			FROM PPT
			INNER JOIN TER ON PPT.IDTERCERO = TER.IDTERCERO
			INNER JOIN TEXCA ON TER.IDTERCERO = TEXCA.IDTERCERO AND TEXCA.IDCATEGORIA = 'CON'
			WHERE PPT.ENRECLAMOS = 1 AND PPT.ESTADO = 'Activo'

		RETURN
	END

	IF @METODO = 'SER'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT IDSERVICIO value, DESCSERVICIO label, SER.IDEMEDICA
							FROM   SER 
							WHERE ' + @WHERES

			PRINT @QUERY

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDSERVICIO value, DESCSERVICIO label, SER.IDEMEDICA
			FROM SER --WHERE PREFIJO in ('003','002')

		RETURN
	END

	IF @METODO = 'CEN'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 
				'SELECT CEN.CCOSTO value, CONCAT(CEN.CCOSTO,'' - '',CEN.DESCRIPCION) label, AFU.DESCRIPCION DESCAREA, CEN.IDAREA
							FROM   CEN 
							INNER JOIN AFU ON AFU.IDAREA = CEN.IDAREA
							WHERE ' 
				+ @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT CEN.CCOSTO value, CONCAT (CEN.CCOSTO, ' - ', CEN.DESCRIPCION) label, AFU.DESCRIPCION DESCAREA, CEN.IDAREA
			FROM CEN INNER JOIN AFU ON AFU.IDAREA = CEN.IDAREA
		RETURN
	END
	IF @METODO = 'AFU'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT AFU.IDAREA value, CONCAT ( AFU.IDAREA,'' - '', AFU.DESCRIPCION )label
							FROM   AFU 
							WHERE ' + @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT AFU.IDAREA value, CONCAT (AFU.IDAREA, ' - ', AFU.DESCRIPCION) label FROM AFU
		RETURN
	END
	IF @METODO = 'PREGR'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 
				'SELECT PREGR.PREFIJO value, CONCAT(PREGR.PREFIJO,'' - '',PRE.NOM_PREFIJO)  label, PRE.ESTADO
							FROM   PREGR 
									INNER JOIN PRE ON PREGR.PREFIJO = PRE.PREFIJO
							WHERE ' 
				+ @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT PREGR.PREFIJO value, CONCAT (PREGR.PREFIJO, ' - ', PRE.NOM_PREFIJO) label, PRE.ESTADO
			FROM PREGR INNER JOIN PRE ON PREGR.PREFIJO = PRE.PREFIJO
		RETURN
	END
	IF @METODO = 'MPLDL'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 
				'SELECT MPLDL.VALORLISTA label, MPLDL.VALOR value 
							FROM MPLD 
							INNER JOIN MPLDL ON MPLD.CLASEPLANTILLA = MPLDL.CLASEPLANTILLA AND MPLD.CAMPO = MPLDL.CAMPO
							WHERE ' 
				+ @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT MPLDL.VALORLISTA label, MPLDL.VALOR value FROM MPLD
			INNER JOIN MPLDL ON MPLD.CLASEPLANTILLA = MPLDL.CLASEPLANTILLA AND MPLD.CAMPO = MPLDL.CAMPO
			WHERE MPLDL.CLASEPLANTILLA = '' AND MPLDL.CAMPO = ''
		RETURN
	END
	IF @METODO = 'PPT'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 
				'SELECT PLN.IDPLAN value, CONCAT(PLN.IDPLAN,'' - '',PLN.DESCPLAN) label, PLN.IDPLAN, PLN.DESCPLAN 
								FROM   PPT INNER JOIN PLN ON PLN.IDPLAN    = PPT.IDPLAN 
										INNER JOIN TER ON TER.IDTERCERO = PPT.IDTERCERO
								WHERE  PPT.ESTADO = ''Activo'' AND' 
				+ @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT PLN.IDPLAN value, CONCAT (PLN.IDPLAN, ' - ', PLN.DESCPLAN) label, PLN.IDPLAN, PLN.DESCPLAN
			FROM PPT INNER JOIN PLN ON PLN.IDPLAN = PPT.IDPLAN
					 INNER JOIN TER ON TER.IDTERCERO = PPT.IDTERCERO
			WHERE PPT.ESTADO = 'Activo' --AND PPT.IDTERCERO = '0100083637'
		RETURN
	END
	IF @METODO = 'PATPLN'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 
				'SELECT PATPLN.IDPATOLOGIA value, PAT.DESCRIPCION label,PATPLN.ITEM, PATPLN.IDTERCERO, PATPLN.IDPLAN, PATPLN.ESTADO
								FROM   PATPLN INNER JOIN PAT ON PATPLN.IDPATOLOGIA = PAT.IDPATOLOGIA
								WHERE  1 = 1 AND' 
				+ @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT PATPLN.IDPATOLOGIA value, PAT.DESCRIPCION label, PATPLN.ITEM, PATPLN.IDTERCERO, PATPLN.IDPLAN, PATPLN.ESTADO
			FROM PATPLN INNER JOIN PAT ON PATPLN.IDPATOLOGIA = PAT.IDPATOLOGIA
		RETURN
	END
	IF @METODO = 'CPCJ'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 
				'SELECT CPCJ.CODIGO value, CONCAT(CPCJ.CODIGO,'' - '',CPCJ.DESCRIPCION ,'' - Cta: '', CPCJ.CUENTA ) label , CPCJ.DESCRIPCION , CPCJ.CUENTA, CPCJ.TIPO, CPCJ.TIPORECIBO, CPCJ.ESTADO, CPCJ.HOMOLOGODIAN, CPCJ.DECAJAMENOR
								FROM   CPCJ
								WHERE  1 = 1 AND ESTADO = ''Activo'' AND ' 
				+ @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT CPCJ.CODIGO value, CPCJ.DESCRIPCION label, CPCJ.CUENTA, CPCJ.TIPO, CPCJ.TIPORECIBO, CPCJ.ESTADO, CPCJ.HOMOLOGODIAN, CPCJ.DECAJAMENOR
			FROM CPCJ WHERE ESTADO = 'Activo'
		RETURN
	END
	IF @METODO = 'TTEC' --AC 20230113
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 
				'SELECT DISTINCT TTEC.CUENTA value, TTEC.DETALLE  label
							FROM TTEC INNER JOIN PPT ON TTEC.TIPO = PPT.TIPOTERCONTABLE 
							WHERE 1 = 1 AND' 
				+ @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT DISTINCT TTEC.CUENTA value, TTEC.DETALLE label FROM TTEC INNER JOIN PPT ON TTEC.TIPO = PPT.TIPOTERCONTABLE
		RETURN
	END
	IF @METODO = 'BCO' --AC 20230113
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT BANCO value, DESCRIPCION label FROM BCO
							WHERE 1 = 1 AND' + @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT BANCO value, DESCRIPCION label FROM BCO
		RETURN
	END
	IF @METODO = 'FDIS' --AC 20231115
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT CODDISTRIBUCION value, DESCRIPCION label, CLASE FROM FDIS
							WHERE 1 = 1 AND' + @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT CODDISTRIBUCION value, DESCRIPCION label, CLASE FROM FDIS
		RETURN
	END
	IF @METODO = 'BCT' --AC 20230208
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 
				'SELECT BCT.CTA_BCO value, CONCAT(BCT.CTA_BCO,'' - '',TGEN.DESCRIPCION) label FROM BCT
							LEFT JOIN TGEN ON BCT.TIPO_CUENTA = TGEN.CODIGO AND TGEN.TABLA = ''GENERAL'' AND CAMPO = ''TIPOCUENTABCT''
							WHERE 1 = 1 AND' 
				+ @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT CTA_BCO value, CONCAT (BCT.CTA_BCO, ' - ', TGEN.DESCRIPCION) label
			FROM BCT LEFT JOIN TGEN ON BCT.TIPO_CUENTA = TGEN.CODIGO AND TGEN.TABLA = 'GENERAL' AND CAMPO = 'TIPOCUENTABCT'
		RETURN
	END
	IF @METODO = 'CAJ' --AC 20230113
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT CODCAJA value, CONCAT(CODCAJA,''-'', DESCRIPCION) label FROM CAJ
							WHERE ESTADO = ''Activo'' AND' + @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT CODCAJA value, CONCAT (CODCAJA, '-', DESCRIPCION) label FROM CAJ WHERE ESTADO = 'Activo'
		RETURN
	END
	IF @METODO = 'KPRG' --AC 20231106
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT CODPRG value, DESCRIPCION label FROM KPRG
							WHERE 1 = 1 AND' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT CODPRG value, DESCRIPCION label FROM KPRG
		RETURN
	END
--QUERY2
--QUERY2
	IF @METODO = 'FNT' --AC 20231106
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT IDNOTA value, DESCRIPCION label ,  TIPO, COMPROBANTE, CUENTA FROM FNT
							WHERE 1 = 1 AND' + @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT IDNOTA value, DESCRIPCION label, TIPO, COMPROBANTE, CUENTA FROM FNT
		RETURN
	END
	IF @METODO = 'FPA' --AC 20230114
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT FORMAPAGO value, DESCRIPCION label FROM FPA
							WHERE 1 = 1 AND' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT FORMAPAGO value, DESCRIPCION label
			FROM FPA

		RETURN
	END

	IF @METODO = 'FCTSERD' --AC 20231108
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 
				'SELECT IDSERVICIO value, CONCAT(FCTSERD.IDTIPOSER, '' - '',FCTSER.DESCRIPCION, '' - '', FCTSERD.IDSERVICIO,'' - '',FCTSERD.DESCRIPCION)   label, FCTSERD.IDTIPOSER, FCTSER.UNSPSC  FROM FCTSERD
							INNER JOIN FCTSER ON FCTSERD.IDTIPOSER = FCTSER.IDTIPOSER
							WHERE 1 = 1 AND' 
				+ @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT FCTSERD.IDSERVICIO value, CONCAT (FCTSERD.IDTIPOSER, ' - ',FCTSER.DESCRIPCION,' - ', FCTSERD.IDSERVICIO, ' - ', FCTSERD.DESCRIPCION) label, 
				FCTSERD.IDTIPOSER, FCTSER.UNSPSC
			FROM FCTSERD
			INNER JOIN FCTSER ON FCTSERD.IDTIPOSER = FCTSER.IDTIPOSER

		RETURN
	END

	IF @METODO = 'NCON' --AC 20231108
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT CODCONCEPTO value, DESCRIPCION label, TIPO, CLASE, ESTADO FROM NCON
							WHERE 1 = 1 AND' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT CODCONCEPTO value, DESCRIPCION label, TIPO, CLASE, ESTADO
			FROM NCON

		RETURN
	END

	IF @METODO = 'FPACODCAJA' --AC 20230114
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 
				'SELECT FPA.FORMAPAGO value, TGEN.DESCRIPCION label, TGEN.CAMPO, TGEN.TABLA, FPA.FISICO FROM FPA
					INNER JOIN TGEN ON FPA.FORMAPAGO = TGEN.CODIGO AND TGEN.CAMPO IN ( ''FORMAPAGO'', ''TIPOEGRESO'')
							WHERE 1 = 1 AND' 
				+ @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT FPA.FORMAPAGO value, TGEN.DESCRIPCION label, TGEN.CAMPO, TGEN.TABLA, FPA.FISICO
			FROM FPA
			INNER JOIN TGEN ON FPA.FORMAPAGO = TGEN.CODIGO AND TGEN.CAMPO IN ('FORMAPAGO', 'TIPOEGRESO')

		RETURN
	END

	IF @METODO = 'CAJR' --AC 20230418
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 
				'SELECT FPA.FORMAPAGO value,  CONCAT(TGEN.DESCRIPCION , '' - '' , COALESCE( CAJR.VALOR,0) ) label, TGEN.CAMPO, TGEN.TABLA, FPA.FISICO, CAJR.VALOR FROM FPA
					INNER JOIN TGEN ON FPA.FORMAPAGO = TGEN.CODIGO AND TGEN.CAMPO IN ( ''FORMAPAGO'', ''TIPOEGRESO'')
					INNER JOIN CAJR ON FPA.FORMAPAGO = CAJR.FORMAPAGO AND TGEN.TABLA = CAJR.CODCAJA
							WHERE 1 = 1 AND' 
				+ @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT FPA.FORMAPAGO value, CONCAT (TGEN.DESCRIPCION, ' - ', COALESCE(CAJR.VALOR, 0)) label, TGEN.CAMPO, TGEN.TABLA, FPA.FISICO, 
				CAJR.VALOR
			FROM FPA
			INNER JOIN TGEN ON FPA.FORMAPAGO = TGEN.CODIGO AND TGEN.CAMPO IN ('FORMAPAGO', 'TIPOEGRESO')
			INNER JOIN CAJR ON FPA.FORMAPAGO = CAJR.FORMAPAGO AND TGEN.TABLA = CAJR.CODCAJA

		RETURN
	END

	IF @METODO = 'MES'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT MES.IDEMEDICA value,MES.DESCRIPCION label FROM MES						  
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT MES.IDEMEDICA value, MES.DESCRIPCION label
			FROM MES

		RETURN
	END

	IF @METODO = 'MESS'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 
				'SELECT CONCAT(SER.IDSERVICIO, '' - '' , SER.DESCSERVICIO ) label, SER.IDSERVICIO value 
								FROM  MESS INNER JOIN SER ON MESS.IDSERVICIO = SER.IDSERVICIO WHERE ' 
				+ @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT CONCAT (SER.IDSERVICIO, ' - ', SER.DESCSERVICIO) label, SER.IDSERVICIO value
			FROM MESS
			INNER JOIN SER ON MESS.IDSERVICIO = SER.IDSERVICIO

		RETURN
	END

	IF @METODO = 'USGRU'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 'SELECT GRUPO value ,NOMBRE label
							FROM   USGRU 
							WHERE  ' + @WHERES

			PRINT @QUERY

			EXEC (@QUERY)
		END
		ELSE
			SELECT GRUPO value, NOMBRE label
			FROM USGRU

		RETURN
	END

	IF @METODO = 'SV'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 
				'SELECT CLASEPLANTILLA value ,DESCPLANTILLA label
							FROM   MPL 
							WHERE  CLASE = ''SV'' AND ESTADO=''Activo'' AND ' + 
				@WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT CLASEPLANTILLA value, DESCPLANTILLA label
			FROM MPL
			WHERE CLASE = 'SV' AND ESTADO = 'Activo'

		RETURN
	END

	IF @METODO = 'MPL_NA'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 
				'SELECT MPLDL.VALOR value,MPLDL.VALORLISTA label,MPLDL.CAMPO,  MPLDL.DESCRITO,  MPLDL.DESCRIPCION
								FROM   dbo.MPLDL
								WHERE  MPLDL.CLASEPLANTILLA = ''NT_ADM01''
								AND   EXISTS (SELECT * FROM (SELECT MPLD.CLASEPLANTILLA, MPLD.SECUENCIA, MPLD.CAMPO, MPLD.TIPO_CAMPO
															FROM   dbo.MPLD
															WHERE  MPLD.CLASEPLANTILLA =  ''NT_ADM01''
															AND    MPLD.TIPO_CAMPO <> ''Grafica''
															AND   MPLD.ESTADO <> ''Inactivo'') X
												WHERE  MPLDL.CLASEPLANTILLA = X.CLASEPLANTILLA
												AND    MPLDL.CAMPO          = X.CAMPO)
											AND ' 
				+ @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT MPLDL.VALOR value, MPLDL.VALORLISTA label, MPLDL.CAMPO, MPLDL.DESCRITO, MPLDL.DESCRIPCION
			FROM dbo.MPLDL
			WHERE MPLDL.CLASEPLANTILLA = 'NT_ADM01' AND EXISTS (
					SELECT *
					FROM (
						SELECT MPLD.CLASEPLANTILLA, MPLD.SECUENCIA, MPLD.CAMPO, MPLD.TIPO_CAMPO
						FROM dbo.MPLD
						WHERE MPLD.CLASEPLANTILLA = 'NT_ADM01' AND MPLD.TIPO_CAMPO <> 'Grafica' AND MPLD.ESTADO <> 'Inactivo'
						) X
					WHERE MPLDL.CLASEPLANTILLA = X.CLASEPLANTILLA AND MPLDL.CAMPO = X.CAMPO
					)
			ORDER BY COALESCE(MPLDL.VALOR, 0)

		RETURN
	END

	IF @METODO = 'MOP'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'ENTRE'

			SELECT @QUERY = 'SELECT MOP.IDMODELOPRE value,MOP.DESCRIPCION label FROM MOP 
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT MOP.IDMODELOPRE value, MOP.DESCRIPCION label
			FROM MOP

		RETURN
	END

	IF @METODO = 'SED'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'ENTRE'

			SELECT @QUERY = 'SELECT SED.IDSEDE value,  CONCAT(SED.IDSEDE , '' '' , SED.DESCRIPCION ) label FROM SED
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT SED.IDSEDE value, SED.DESCRIPCION label
			FROM SED

		RETURN
	END

	IF @METODO = 'NCARNG'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'ENTRE'

			SELECT @QUERY = 'SELECT NCARNG.CODCARGO,NCARNG.NIVEL,NCARNG.GRADO, NCARNG.DESCRIPCION label FROM NCARNG
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT NCARNG.CODCARGO, NCARNG.NIVEL, NCARNG.GRADO, NCARNG.DESCRIPCION label
			FROM NCARNG

		RETURN
	END

	IF @METODO = 'GSS'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'ENTRE'

			SELECT @QUERY = 'SELECT GSS.IDGRUPOSER value,  CONCAT(GSS.IDGRUPOSER , '' '' , GSS.DESCRIPCION ) label FROM GSS
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT GSS.IDGRUPOSER value, CONCAT (GSS.IDGRUPOSER, ' - ', GSS.DESCRIPCION) label
			FROM GSS

		RETURN
	END

	IF @METODO = 'IBOD'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'ENTRE'

			SELECT @QUERY = 'SELECT IDBODEGA value,CONCAT(IDBODEGA,'' - '',DESCRIPCION) label FROM IBOD
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDBODEGA value, CONCAT (IDBODEGA, ' - ', DESCRIPCION) label
			FROM IBOD

		RETURN
	END

	IF @METODO = 'SEDSAC'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'ENTRE'

			SELECT @QUERY = 'SELECT SED.IDSEDE value,SED.DESCRIP_SAC label FROM SED
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT SED.IDSEDE value, SED.DESCRIPCION label
			FROM SED

		RETURN
	END

	IF @METODO = 'CROVIG'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 
				'SELECT IDCROVIG value, ''Per?do:'' +CONVERT(VARCHAR(10),FECHAINICIAL,103)+'' - ''+CONVERT(VARCHAR(10),FECHAFINAL,103) label FROM CROVIG
							WHERE ' 
				+ @WHERES + 'ORDER BY FECHAINICIAL DESC'

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDCROVIG value, 'Per?do:' + CONVERT(VARCHAR(10), FECHAINICIAL, 103) + ' - ' + CONVERT(VARCHAR(10), FECHAFINAL, 103) label
			FROM CROVIG
			ORDER BY FECHAINICIAL DESC

		RETURN
	END

	IF @METODO = 'MSJP'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT PLANTILLA value, DESCRIPCION label FROM MSJP        
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT PLANTILLA value, DESCRIPCION label
			FROM MSJP

		RETURN
	END

	IF @METODO = 'USUSU'
	BEGIN
		SELECT @QUERY = 
			'SELECT USUSU.NOMBRE label, USUSU.USUARIO value, CASE WHEN USUSU.TIPO=''M'' THEN USUSU.IDMEDICO ELSE USUSU.USUARIO END IDMEDICO
							FROM USUSU '

		IF COALESCE(@WHERES, '') <> ''
			SELECT @QUERY += ' WHERE ' + @WHERES

		EXEC (@QUERY)

		RETURN
	END

	IF @METODO = 'UMEREG'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT CAST (ID AS VARCHAR(5)) value, NOMBRE label FROM UMEREG 
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT CAST(ID AS VARCHAR(5)) value, NOMBRE label
			FROM UMEREG

		RETURN
	END
   
	IF @METODO = 'UMEREGXCIU'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT DISTINCT  CAST (UMEREG.ID AS VARCHAR(5)) value, UMEREG.NOMBRE label FROM UMEREG INNER JOIN CIUDV ON UMEREG.ID = CIUDV.IDUMEREG
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT CAST(ID AS VARCHAR(5)) value, NOMBRE label
			FROM UMEREG

		RETURN
	END

	IF @METODO = 'HHAB'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT HABCAMA value, DESCRIPCION label FROM HHAB
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT HABCAMA value, DESCRIPCION label
			FROM HHAB

		RETURN
	END

	IF @METODO = 'HHABSEC'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT HABCAMA value, CONCAT(SECTOR,'' - '', DESCRIPCION) label FROM HHAB
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT HABCAMA value, CONCAT(SECTOR,' - ', DESCRIPCION) label
			FROM HHAB

		RETURN
	END

	IF @METODO = 'HHABCNF'
	BEGIN
		SELECT @QUERY = 
			'SELECT HHABCNF.OPCION value, TGEN.DESCRIPCION label 
			FROM HHABCNF
			LEFT JOIN TGEN ON TGEN.TABLA=''GENERAL'' AND TGEN.CAMPO=''CLASEHOSP'' AND HHABCNF.OPCION = TGEN.CODIGO'

		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SET @QUERY += ' WHERE ' + @WHERES
		END

		EXEC (@QUERY)

		RETURN
	END

	IF @METODO = 'PRE'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT PRE.PREFIJO value, CONCAT(PRE.PREFIJO,'' - '',PRE.NOM_PREFIJO) label 
							FROM   PRE
							WHERE  ' + @WHERES + 
				'
							ORDER BY NOM_PREFIJO'

			EXEC (@QUERY)
		END
		ELSE
			SELECT PRE.PREFIJO value, CONCAT (PRE.PREFIJO, ' - ', PRE.NOM_PREFIJO) label
			FROM PRE
			ORDER BY NOM_PREFIJO

		RETURN
	END

	IF @METODO = 'ANEXO_TRONCAL'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT TGEN.CODIGO value, CONCAT(TGEN.CODIGO,'' - '',TGEN.DESCRIPCION) label 
							FROM   TGEN
							WHERE  ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT TGEN.CODIGO value, CONCAT (TGEN.CODIGO, ' - ', TGEN.DESCRIPCION) label
			FROM TGEN

		RETURN
	END

	IF @METODO = 'TSECF'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 
				'SELECT A.CODTURNO value, A.CODTURNO + '' - '' + B.DESCRIPCION label 
							FROM   TSECF A
							INNER JOIN TUR B ON A.CODTURNO=B.CODTURNO AND B.ESTADO=''Activo''
							WHERE  ' 
				+ @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT A.CODTURNO value, A.CODTURNO + ' - ' + B.DESCRIPCION label
			FROM TSECF A
			INNER JOIN TUR B ON A.CODTURNO = B.CODTURNO AND B.ESTADO = 'Activo'

		RETURN
	END

	IF @METODO = 'TPERDA'
	BEGIN
		SELECT @QUERY = 'SELECT DISTINCT TPERD.ANO value, TPERD.ANO label 
						FROM   TPERD
						'

		IF COALESCE(@WHERES, '') <> ''
			SET @QUERY += ' WHERE  ' + @WHERES

		EXEC (@QUERY)

		RETURN
	END

	IF @METODO = 'TPERDM'
	BEGIN
		SELECT @QUERY = 
			'SELECT DISTINCT TPERD.MES value, DATENAME(MONTH,CONVERT(DATE, CONVERT(VARCHAR,ANO)+RIGHT(''0''+CONVERT(VARCHAR,MES),2)+''01'')) label 
						FROM   TPERD
						'

		IF COALESCE(@WHERES, '') <> ''
			SET @QUERY += ' WHERE  ' + @WHERES
		SET @QUERY += ' ORDER BY TPERD.MES'

		EXEC (@QUERY)

		RETURN
	END

	IF @METODO = 'TPERA'
	BEGIN
		SELECT @QUERY = 'SELECT DISTINCT TPER.ANO value, TPER.ANO label 
						FROM   TPER
						'

		IF COALESCE(@WHERES, '') <> ''
			SET @QUERY += 'WHERE  ' + @WHERES

		EXEC (@QUERY)

		RETURN
	END

	IF @METODO = 'TPERM'
	BEGIN
		SELECT @QUERY = 
			'SELECT TPER.MES value, RIGHT(''0''+CONVERT(VARCHAR,MES),2) + '' - '' + DATENAME(MONTH,CONVERT(DATE, CONVERT(VARCHAR,ANO)+RIGHT(''0''+CONVERT(VARCHAR,MES),2)+''01'')) label 
						FROM TPER
						'

		IF COALESCE(@WHERES, '') <> ''
			SET @QUERY += ' WHERE  ' + @WHERES

		EXEC (@QUERY)

		RETURN
	END

	IF @METODO = 'NEVE'
	BEGIN
		SELECT @QUERY = 'SELECT IDEVENTO value, IDEVENTO +'' - ''+DESCRIPCION label
								FROM   NEVE'

		IF COALESCE(@WHERES, '') <> ''
			SELECT @QUERY += ' WHERE ' + @WHERES

		PRINT @QUERY

		EXEC (@QUERY)

		RETURN
	END

	IF @METODO = 'TRCL'
	BEGIN
		SELECT @QUERY = 'SELECT IDTRECLAMO value, DESCRIPCION label ,DIASLIMITE ,DIASREASIGNA
								FROM   TRCL'

		IF COALESCE(@WHERES, '') <> ''
			SELECT @QUERY += ' WHERE ' + @WHERES

		EXEC (@QUERY)

		RETURN
	END

	IF @METODO = 'IART'
	BEGIN
		SELECT @QUERY = 'SELECT IDARTICULO value,CONCAT(IDARTICULO,'' - '', DESCRIPCION)  label
						FROM IART '

		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY += ' WHERE ' + @WHERES
		END

		EXEC (@QUERY)

		RETURN
	END

	IF @METODO = 'FTR'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT N_FACTURA value, N_FACTURA label FROM FTR
							WHERE ESTADO=''P'' AND COALESCE(TIPOANULACION,'''') ='''' AND  ' + 
				@WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT N_FACTURA value, N_FACTURA label
			FROM FTR
			WHERE ESTADO = 'P' AND COALESCE(TIPOANULACION, '') = ''

		RETURN
	END

	IF @METODO = 'HADM'
	BEGIN
		SELECT @QUERY = 'SELECT NOADMISION value,CONCAT(NOADMISION,'' - '', FECHA )  label
						FROM HADM '

		IF COALESCE(@WHERES, '') <> ''
			SELECT @QUERY += ' WHERE ' + @WHERES

		EXEC (@QUERY)

		RETURN
	END

	IF @METODO = 'CIT'
	BEGIN
		SELECT @QUERY = 'SELECT CONSECUTIVO value,CONCAT(CONSECUTIVO,'' - '', FECHA )  label
						FROM CIT '

		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY += ' WHERE ' + @WHERES
		END

		EXEC (@QUERY)

		RETURN
	END

	IF @METODO = 'AUT'
	BEGIN
		SELECT @QUERY = 'SELECT NOAUT value,CONCAT(NOAUT,'' - '', FECHA )  label
						FROM AUT '

		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY += ' WHERE ' + @WHERES
		END

		EXEC (@QUERY)

		RETURN
	END

	IF @METODO = 'CJTE'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT TIPOEGRESO value, DESCRIPCION label, CJTE.IDCATEGORIA,CJTE.MTERCERO   FROM CJTE
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT TIPOEGRESO value, DESCRIPCION label
			FROM CJTE

		RETURN
	END

	IF @METODO = 'ITMO' /* AC 20231205 */
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT IDTIPOMOV value, CONCAT(IDTIPOMOV,'' - '', DESCRIPCION ) label , TIPO, ESTADO  FROM ITMO
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDTIPOMOV value, CONCAT (IDTIPOMOV, ' - ', DESCRIPCION) label, TIPO, ESTADO
			FROM ITMO

		RETURN
	END

	IF @METODO = 'ITAR' /* AC 20231211 */
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT IDITAR value,CONCAT(IDITAR,'' - '', DESCRIPCION )  label  FROM ITAR
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDITAR value, CONCAT (IDITAR, ' - ', DESCRIPCION) label
			FROM ITAR
			ORDER BY ITAR.IDITAR ASC

		RETURN
	END

	IF @METODO = 'ADXPLANT' /* AC 20231212 */
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT IDADXPLANT value, NOMBRE label, AMBITO, PLANTILLA, TIPO   FROM ADXPLANT
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDADXPLANT value, NOMBRE label, AMBITO, PLANTILLA, TIPO
			FROM ADXPLANT
			ORDER BY ADXPLANT.IDADXPLANT ASC

		RETURN
	END

	IF @METODO = 'HOMDATOS' /* AC 20240204 */
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT CODIGO value, CONCAT(CODIGO,'' - '', DESCRIPCION ) label, ESTADO, TIPO   FROM HOMDATOS
							WHERE ' + @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT CODIGO value, CONCAT (CODIGO, ''' - ''', DESCRIPCION) label, ESTADO, TIPO
			FROM HOMDATOS
			ORDER BY HOMDATOS.CODIGO ASC

		RETURN
	END

	IF @METODO = 'TGENOP'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 
				'SELECT CODIGO value ,DESCRIPCION label , (SELECT OPCION, DESCRIPCION FROM TGENOP O WHERE O.TABLA=TGEN.TABLA AND O.CAMPO=TGEN.CAMPO AND O.CODIGO=TGEN.CODIGO FOR JSON PATH) TGENOP
							FROM   TGEN
							WHERE  ' 
				+ @WHERES + 'ORDER BY DESCRIPCION ASC'

			PRINT @QUERY

			EXEC (@QUERY)
		END

		RETURN
	END

	IF @METODO = 'MED_2' /* AC 20240219*/
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 
				'SELECT MED.IDMEDICO value, CONCAT(MED.IDMEDICO,'' - '',MED.NOMBRE) label , MED.IDEMEDICA, MED.ESTADO
							FROM   MED 
							WHERE  ' 
				+ @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT MED.IDMEDICO value, CONCAT (MED.IDMEDICO, ' - ', MED.NOMBRE) label
			FROM med

		RETURN
	END

	IF @METODO = 'CPPAF' /* OS 20240331*/
	BEGIN
		SELECT @QUERY = 
			'SELECT SER.IDSERVICIO value, CONCAT(SER.IDSERVICIO,'' - '',SER.DESCSERVICIO) label 
						FROM   CPPAF 
						INNER JOIN SER ON SER.IDSERVICIO=CPPAF.IDSERVICIO
						'

		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY += 'WHERE  ' + @WHERES
		END

		EXEC (@QUERY)

		RETURN
	END

	IF @METODO = 'RUTA_MED' /* AC 20241209*/
	BEGIN
		SELECT @QUERY = 
			'SELECT RUTA.IDMEDICO value , CONCAT(''['',UMEREG.NOMBRE, ''] - '', MED.NOMBRE) label, MED.NOMBRE [MEDICO], RUTA.IDUMEREG [ZONA] , RUTA.FECHA , RUTA.ID [ID_RUTA]
						FROM RUTA
								INNER JOIN MED ON RUTA.IDMEDICO = MED.IDMEDICO
								INNER JOIN UMEREG ON RUTA.IDUMEREG = UMEREG.ID
						'

		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY += 'WHERE  ' + @WHERES
		END

		EXEC (@QUERY)

		RETURN
	END

	IF @METODO = 'IACTT' /* AC 20240219*/
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 'SELECT IDTIPOACTIVO value,  CONCAT(''['',IDTIPOACTIVO, ''] - '', DESCRIPCION) label, ESTADO , CLASE FROM IACTT WHERE' + 
				@WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT IDTIPOACTIVO value, DESCRIPCION label, ESTADO, CLASE
			FROM IACTT

		RETURN
	END

	IF @METODO = 'VACE' /* AC 20250314*/
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 
				'SELECT VACE.CONSECUTIVO value, VACE.LOTE label, VACE.IDVACUNA  FROM VACE 
								INNER JOIN SER ON SER.IDSERVICIO = VACE.IDVACUNA
							WHERE  VACE.ESTADO = ''Cerrado'' AND VACE.EXISTLOTE > 0 AND  COALESCE(VACE.LOTE,'''')<>''''
							' 
				+ @WHERES

			EXEC (@QUERY)
		END
		ELSE
			SELECT VACE.CONSECUTIVO value, VACE.LOTE label, VACE.IDVACUNA
			FROM VACE
			INNER JOIN SER ON SER.IDSERVICIO = VACE.IDVACUNA
			WHERE VACE.ESTADO = 'Cerrado' AND VACE.EXISTLOTE > 0 AND COALESCE(VACE.LOTE, '') <> ''

		RETURN
	END

	IF @METODO = 'TGEN_MES'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 'SELECT CODIGO value ,DESCRIPCION label ,DATO1, cast(valor1 as bit) as sector
							FROM   TGEN
							WHERE  ' + @WHERES + 
				'ORDER BY VALOR1 ASC'

			PRINT @QUERY

			EXEC (@QUERY)
		END

		RETURN
	END

	IF @METODO = 'ROL'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			PRINT 'INGRESE'

			SELECT @QUERY = 'SELECT IDROL value ,DESCRIPCION label 
							FROM   ROL
							WHERE  ' + @WHERES

			PRINT @QUERY

			EXEC (@QUERY)
		END

		RETURN
	END
	IF @METODO = 'HTHA'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT HTHA.TIPO value,  CONCAT(HTHA.TIPO , '' '' , HTHA.DESCRIPCION ) label FROM HTHA
							WHERE ' + @WHERES
			EXEC (@QUERY)
		END
		ELSE
			SELECT HTHA.TIPO value, HTHA.DESCRIPCION label FROM HTHA
		RETURN
	END
	IF @METODO = 'CIUDV'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT CODIGO value ,DESCRIPCION label , CIUDAD, IDUMEREG
							 FROM   CIUDV WHERE  ' + @WHERES 
			EXEC (@QUERY)
		END
		RETURN
	END
	IF @METODO = 'SEDCONS'
	BEGIN
		IF COALESCE(@WHERES, '') <> ''
		BEGIN
			SELECT @QUERY = 'SELECT CAST ( IDSEDCONS AS VARCHAR) value ,DESCCONS label , IDSEDE , NUMCONS,  TIPO, ESTADO
							 FROM   SEDCONS WHERE  ' + @WHERES 
			EXEC (@QUERY)
		END
		RETURN
	END
	IF @METODO = 'GDX'
	BEGIN
		SELECT @QUERY = 'SELECT GRUPOENF value ,DESCRIPCION label
							FROM   GDX '
		IF @WHERES<>''
		BEGIN
			SET @QUERY += ' WHERE '+@WHERES
		END
		EXEC (@QUERY)
		RETURN
	END
	
	IF @METODO = 'GDXS'
	BEGIN
		SELECT @QUERY = 'SELECT SGRUPODX value ,DESCRIPCION label
							FROM GDXS '
		IF @WHERES<>''
		BEGIN
			SET @QUERY += ' WHERE '+@WHERES
		END
		EXEC (@QUERY)
		RETURN
	END

	IF @METODO = 'PTCLA'
	BEGIN
		SELECT @QUERY = 'SELECT CLASIFICACION value ,DESCRIPCION label
							FROM PTCLA '
		IF @WHERES<>''
		BEGIN
			SET @QUERY += ' WHERE '+@WHERES
		END
		EXEC (@QUERY)
		RETURN
	END
	IF @METODO = 'MDS'
	BEGIN
		SELECT @QUERY = 'SELECT IDMODELODSS value ,DESCMODELODSS label
							FROM MDS '
		IF @WHERES<>''
		BEGIN
			SET @QUERY += ' WHERE '+@WHERES
		END
		EXEC (@QUERY)
		RETURN
	END
	IF @METODO = 'NPLT'
	BEGIN
		SELECT @QUERY = 'SELECT IDPLANTILLA value ,DESCRIPCION label
							FROM NPLT '
		IF @WHERES<>''
		BEGIN
			SET @QUERY += ' WHERE '+@WHERES
		END
		EXEC (@QUERY)
		RETURN
	END
	IF @METODO = 'PTREC'
	BEGIN
		SELECT @QUERY = 'SELECT RECURSO value ,DESCRIPCION label
							FROM PTREC '
		IF @WHERES<>''
		BEGIN
			SET @QUERY += ' WHERE '+@WHERES
		END
		EXEC (@QUERY)
		RETURN
	END
	IF @METODO = 'PTDIV'
	BEGIN
		SELECT @QUERY = 'SELECT DIVISION value ,DESCRIPCION label
							FROM PTDIV '
		IF @WHERES<>''
		BEGIN
			SET @QUERY += ' WHERE '+@WHERES
		END
		EXEC (@QUERY)
		RETURN
	END
	IF @METODO = 'VW_PXS'
	BEGIN
		SELECT @QUERY = 'SELECT DISTINCT IDTERCERO value ,RAZONSOCIAL label
							FROM VW_PXS '
		IF @WHERES<>''
		BEGIN
			SET @QUERY += ' WHERE '+@WHERES
		END
      
		EXEC (@QUERY)
		RETURN
	END
	IF @METODO = 'COM'
	BEGIN
		SELECT @QUERY = 'SELECT COMPROBANTE value ,CONCAT(COMPROBANTE,'' - '',NOMCOMPROBANTE) label
							FROM COM
                     WHERE COMPANIA=''01'' '
		IF @WHERES<>''
		BEGIN
			SET @QUERY += ' AND  WHERE '+@WHERES
		END
      SET @QUERY += ' ORDER BY COMPROBANTE ASC '
		EXEC (@QUERY)
		RETURN
	END
   
END



