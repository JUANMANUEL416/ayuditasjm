use ksanitasperu

SELECT * FROM AUTD WHERE IDAUT='0100000316'

SELECT  * FROM AFI WHERE DOCIDAFILIADO='33949442'

SELECT CONSECUTIVOCIT, * FROM AUT WHERE IDAFILIADO='0100001838'

SELECT  * FROM USVGS WHERE DESCRIPCION LIKE '%MOVILIDAD%'

SELECT * FROM VWK_RESUCIT_AUT WHERE CONSECUTIVOCIT='010163377057'

SELECT  * FROM AUT WHERE CONSECUTIVOCIT='0106'

SELECT  * FROM AUTD WHERE IDAUT='0100000185'
UPDATE AUTD SET CANTIDAD=1,GENERADO=1,COPAGO_VARIABLE=100,VALOREXCEDENTE=VALOR*CANTIDAD,VALORCOPAGO=0 WHERE IDAUT='0100000185' AND IDSERVICIO='MOB030'

EXEC SPK_CONFIRMAR_AUT '0100000185'

EXEC SPK_RECALCULAR_COPAGOS_AUTD '0100000185'

SELECT AUT.CONSECUTIVOCIT,AUT.NOAUT,AUT.ESPROGRAMAS,AUTD.IDSERVICIO,SUM(CASE WHEN COALESCE(AUTD.PROTOCOLO,0)= 1  THEN  AUTD.VALOREXCEDENTE ELSE 0 END)VLR_PROTOCOLO,
SUM(CASE WHEN COALESCE(AUTD.PROTOCOLO,0)= 0 THEN  AUTD.VALOREXCEDENTE ELSE 0 END)VLR_AGUDO,
CASE WHEN AUTD.IDSERVICIO=DBO.FNK_VALORVARIABLE('IDSERMOVILIDAD') THEN 0 ELSE 
CASE WHEN COALESCE(AUTD.ESDELAB,0)=1 THEN CASE WHEN COALESCE(AUTD.ENLAB,0)=2 THEN 0 ELSE 1 END 
ELSE CASE WHEN COALESCE(APOYODG_AMBITO,'')<> '' AND COALESCE(AUTD.ENLAB,0)=2  THEN 0 
      WHEN COALESCE(APOYODG_AMBITO,'')<> '' AND COALESCE(AUTD.ENLAB,0)<> 2  THEN 1 ELSE 1 END END END DX_PEND
FROM  AUT INNER JOIN AUTD ON AUTD.IDAUT     = AUT.IDAUT 
		INNER JOIN SER  ON SER.IDSERVICIO = AUTD.IDSERVICIO 
		LEFT JOIN TER  ON TER.IDTERCERO  = AUTD.IDTERCEROCA
      LEFT JOIN TGEN ON AUT.IDFARMACIA=TGEN.CODIGO 
                        AND TGEN.CAMPO=CASE WHEN AUT.PREFIJO=DBO.FNK_VALORVARIABLE('PREFIJOMEDICAMENTOS') THEN 'FARMACIA'
                                            WHEN AUT.PREFIJO=DBO.FNK_VALORVARIABLE('PREFIJOLABORATORIO') THEN 'EXAMENES'
                                            WHEN AUT.PREFIJO=DBO.FNK_VALORVARIABLE('OMCODAPOYODX') THEN 'APOYO'  ELSE '' END
                        AND TGEN.TABLA='DISTRIBUIDORES'
WHERE COALESCE(AUTD.NOCOBRABLE,0)=0
AND COALESCE(AUTD.GENERADO,0)=1
AND COALESCE(AUTD.FACTURADA,0)=0
AND COALESCE(AUTD.VALOR,0)>0
AND COALESCE(AUTD.VALOREXCEDENTE,0)>0
AND AUT.CONSECUTIVOCIT='010163378277'
AND NOT EXISTS(SELECT * FROM CIT WHERE AUT.CONSECUTIVOCIT=CIT.CONSECUTIVO AND COALESCE(FACTURADA,0)=1)
GROUP BY AUT.CONSECUTIVOCIT,AUT.NOAUT,AUTD.ESDELAB,AUTD.ENLAB,AUT.ESPROGRAMAS,AUTD.IDSERVICIO,COALESCE(APOYODG_AMBITO,'')



SELECT CONSECUTIVOCIT, * FROM AUT WHERE IDAUT='0100000890'
SELECT  * FROM AUTD WHERE IDAUT='0100000890'


SELECT * FROM VWK_RESUCIT_AUT WHERE CONSECUTIVOCIT ='010163378277'

SELECT * FROM VWK_RESUCIT_AUT WHERE IDAUT ='0100002493'

SELECT *
FROM   AUT INNER JOIN AUTD ON AUTD.IDAUT     = AUT.IDAUT 
				INNER JOIN SER  ON SER.IDSERVICIO = AUTD.IDSERVICIO 
				LEFT JOIN TER  ON TER.IDTERCERO  = AUTD.IDTERCEROCA
	WHERE  AUT.CONSECUTIVOCIT = '010163378277'             
		--AND AUTD.IDPLAN=@IDPLAN
      AND COALESCE(AUTD.NOCOBRABLE,0)=0
      AND COALESCE(AUTD.GENERADO,0)=1
      AND COALESCE(AUTD.FACTURADA,0)=0
      AND COALESCE(AUTD.VALOR,0)>0
      AND COALESCE(AUTD.VALOREXCEDENTE,0)>0
      AND COALESCE(AUT.LISTOFACT,'PEND')IN('OK','PEND')
      --AND 1=CASE WHEN AUTD.IDSERVICIO=DBO.FNK_VALORVARIABLE('IDSERMOVILIDAD') THEN 1 ELSE CASE WHEN COALESCE(AUTD.ESDELAB,0)=1 THEN CASE WHEN COALESCE(AUTD.ENLAB,0)=2 THEN 1 ELSE 0 END 
      --            ELSE CASE WHEN COALESCE(APOYODG_AMBITO,'')<> '' AND COALESCE(AUTD.ENLAB,0) = 2  THEN 1
      --                  WHEN COALESCE(APOYODG_AMBITO,'')<> '' AND COALESCE(AUTD.ENLAB,0)<> 2  THEN 0 ELSE 1 END END END


      SELECT   DISTINCT ESTADO FROM KPAGE 



SELECT CONSECUTIVOCIT, * FROM AUT WHERE IDAUT='0100000346'
SELECT  * FROM AUTD WHERE IDAUT='0100000346'
SELECT * FROM VWK_RESUCIT_AUT WHERE CONSECUTIVOCIT ='010163378277'

UPDATE AUTD SET FACTURADA=0,N_FACTURA=NULL WHERE IDAUT='0100000346'

SELECT * FROM CIT WHERE CONSECUTIVO='010163378233'

SELECT * FROM AFI WHERE IDAFILIADO='0100000205'

SELECT * FROM AUT WHERE CONSECUTIVOCIT='010163378408'

UPDATE AUT SET FACTURABLE=0,GENERADO=0,LISTOFACT='NOFACT' WHERE IDAUT='0100000862'


SELECT  * FROM AUTD WHERE IDAUT='0100001973'

UPDATE AUTD SET NOCOBRABLE=1 WHERE IDAUT='0100000386' AND IDSERVICIO='MOB030'

UPDATE AUTD SET FACTURADA=0,N_FACTURA=NULL WHERE IDAUT='0100000861' AND N_FACTURA='F002-00000254'

SELECT * FROM PLN

SELECT PROCEDENCIA, * FROM FTRD WHERE N_FACTURA='F002-00000254'
SELECT PROCEDENCIA, * FROM FTR WHERE N_FACTURA='F002-00000254'

SELECT * FROM AUT WHERE IDPLAN='PAQ021' AND PREFIJO='006'

UPDATE AUT SET LISTOFACT='NOFACT' WHERE IDPLAN='PAQ020' AND PREFIJO='006'

SELECT * FROM PLN WHERE IDPLAN='PAQ020'

SELECT  * FROM AUTD WHERE IDAUT='0100003061'

SELECT  * FROM SER WHERE IDSERVICIO IN('230102','440801')


SELECT * FROM AUT WHERE AUT.IDPLAN='PAQ021' AND PREFIJO='005'
AND VALORCOPAGO > 0 AND IDKPAGE IS NULL
AND AUT.FECHA<GETDATE()-20


UPDATE AUT SET LISTOFACT='NOFACT' WHERE AUT.IDPLAN='PAQ021' AND PREFIJO='005'
AND VALORCOPAGO > 0 AND IDKPAGE IS NULL
AND AUT.FECHA<GETDATE()-20

SELECT * FROM AUT INNER JOIN AUTD ON AUT.IDAUT=AUTD.IDAUT
WHERE AUT.IDPLAN='PAQ021' AND PREFIJO='005'
AND AUTD.ENLAB<>2
AND AUT.VALORCOPAGO > 0 AND IDKPAGE IS NULL
AND AUT.FECHA<GETDATE()-20
AND AUT.LISTOFACT<>'NOFACT'


UPDATE AUT SET LISTOFACT='NOFACT' FROM AUT INNER JOIN KPAGE ON AUT.IDKPAGE=KPAGE.IDKPAGE
WHERE AUT.IDPLAN='PAQ021' AND PREFIJO='005'
AND KPAGE.ESTADO<>'PAID'
AND KPAGE.F_EXPIRA<GETDATE()
AND AUT.FECHA<GETDATE()-20

SELECT TOP 10 * FROM API_LOG WHERE USUARIO='FRODRIGUEZ' ORDER BY ITEM DESC

BEGIN TRAN
EXEC SPQ_JSON '{"MODELO":"FTR_PERU","METODO":"FACTURAR_CITAUT","PARAMETROS":{"CONSECUTIVO":"010496936660"},"USUARIO":"FRODRIGUEZ"}'

ROLLBACK

SELECT FACTURABLE, * FROM CIT WHERE CONSECUTIVO='010496936660'

UPDATE CIT SET FACTURABLE=1 WHERE CONSECUTIVO='010496936660'

SELECT  * FROM CIT WHERE FACTURABLE=0 AND FECHAATENCION IS NOT NULL

UPDATE  CIT SET FACTURABLE=1  WHERE FACTURABLE=0 AND FECHAATENCION IS NOT NULL

SELECT * FROM FTR WHERE N_FACTURA='F002-00000308'


SELECT IDKPAGE,TIPOCAJA,NFACTURA, * FROM CIT WHERE CONSECUTIVO='010496937957'

EXEC SPK_VALIDAR_IZIPAY_JOB 485

SELECT  * FROM KPAGE WHERE IDKPAGE=485

UPDATE  KPAGE SET ESTADO='SEND' WHERE IDKPAGE=485

SELECT TOP 10 * FROM API_LOG WHERE USUARIO='FRODRIGUEZ' ORDER BY ITEM DESC

EXEC SPQ_JSON '{"MODELO":"CIT_COL_2","METODO":"DISPONIBILIDAD","PARAMETROS":{"DIA":"2025-01-20","ESPECIALIDAD":"028","MODALIDAD":"","IDSEDE":"01","DISPONIBILIDAD":"Todos","IDTERCERO":null},"USUARIO":"FRODRIGUEZ"}'


SELECT  * FROM CIT WHERE NOADMISION='010000000558'

SELECT  * FROM AUT WHERE CONSECUTIVOCIT='010191583430'

UPDATE AUT SET LISTOFACT='OK' WHERE IDAUT='0100001122'

SELECT FACTEP, * FROM FTR WHERE FACTEP<>'102' AND F_FACTURA>GETDATE()-1

SELECT * FROM FTRD WHERE N_FACTURA='F002-00000233'

EXEC SPK_GENERA_JSON_PERU_FTR_INTEGRA 'F002-00000232'

SELECT CONVERT(DECIMAL(14,2),VR_TOTAL-(((VALOR-VLR_COPAGOS)+CASE WHEN PIVA>0 THEN (VIVA/CANTIDAD) ELSE 0 END)*CANTIDAD)),* FROM FTRD WHERE N_FACTURA='F002-00000233'