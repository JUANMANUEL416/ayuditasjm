DECLARE @NROCOMPROBANTE VARCHAR(20)
DECLARE @COMPANIA VARCHAR(2)
DECLARE @USUARIO VARCHAR(20)
DECLARE @SYS_COMPUTERNAME VARCHAR(20)
DECLARE @IDSEDE           VARCHAR(6)
DECLARE @COMPROBANTE      VARCHAR(2)

	DECLARE MCPNIIF_CURSOR CURSOR FOR 
   SELECT MCP.NROCOMPROBANTE,MCP.COMPANIA,MCP.USUARIO,'IXSOPORTE',MCP.IDSEDE,MCP.COMPROBANTE
   FROM MCP 
   WHERE MCP.ESTADO=2
   AND MCP.ANOMES>='201808' --AND ANOMES<='201812'
   AND COALESCE(ANULADO,0)<>1
   ORDER BY ANOMES,MCP.COMPROBANTE        
	OPEN MCPNIIF_CURSOR    
	FETCH NEXT FROM MCPNIIF_CURSOR    
	INTO @NROCOMPROBANTE,@COMPANIA,@USUARIO,@SYS_COMPUTERNAME,@IDSEDE,@COMPROBANTE
	WHILE @@FETCH_STATUS = 0    
	BEGIN
      IF NOT EXISTS(SELECT * FROM MCPNIIF WHERE NROCOMPROBANTEMCP=@NROCOMPROBANTE) 
      BEGIN
         UPDATE MCP SET ENVNIIF=0,NROCOMPROBANTENIIF='' WHERE NROCOMPROBANTE=@NROCOMPROBANTE

         EXEC SPK_PASA_MCP_MCPNIIF_JM @NROCOMPROBANTE,@COMPANIA,@USUARIO,@SYS_COMPUTERNAME,@IDSEDE,@COMPROBANTE,''
      END       
	FETCH NEXT FROM MCPNIIF_CURSOR    
	INTO @NROCOMPROBANTE,@COMPANIA,@USUARIO,@SYS_COMPUTERNAME,@IDSEDE,@COMPROBANTE
	END
	CLOSE MCPNIIF_CURSOR
	DEALLOCATE MCPNIIF_CURSOR