
SELECT * FROM #A

01201702P30-1

SELECT * FROM NEMPF

DELETE NEMPFD WHERE CNSPAGO='01201702P30-1'
DELETE NEMPF WHERE CNSPAGO='01201702P30-1'

SELECT * FROM KAnashiwaya.DBO.NEMPFD
-- INSERTO EN NEMPF
INSERT INTO NEMPF(NUMDOC, CNSPAGO, ITEM, VALOR_NETO, VALOR_INGRESOS, VALOR_EGRESOS, VALOR_APORTES, VALOR_INGRESOS100P, PEGRESOS, PLIBRE_EGRESOS)
SELECT NUMDOC,'01201702P30-1','CAR00001',0,0,0,0,0,0,0
FROM #A A 
GROUP BY NUMDOC

-- INSERTO EN NEMPFD
INSERT INTO NEMPFD(NUMDOC, CNSPAGO, ITEM, LINEA,  DETALLE,CODCONCEPTO, VALOR, VALOR_EMPRESA, VALOR100P, CANTIDAD, IDTRANSPRESTAMO, NUMDOCPRESTAMO, NUMCUOTA, CODPRF, IDTERCERO, PSOBREINGRESOS, INCLUIR_EXCLUIR,  LIQUIDAR, INFO, BASE_PRESTACIONES, ITEMCONCEPTO, CODCONCEPTO_PADRE, LINEA_PADRE, VALHORASLAB, GENERANOVEFU, CODNOVEFU, BASE_CALCULO)
SELECT NUMDOC,'01201702P30-1','CAR00001',ROW_NUMBER() OVER(PARTITION BY NUMDOC ORDER BY NUMDOC ASC)NRO,'',CONCEPTO,VLR_EMPLE,VLR_EGRESO,CASE WHEN VLR_EGRESO>0 THEN 0 ELSE VLR_EMPLE END,240,
'','',0,(SELECT TOP 1 CODPRF FROM NCOND WHERE CODCONCEPTO=A.CONCEPTO ORDER BY FECHAINI DESC),IDTERCERO,0,'Automatica','Si','No','No',1,NULL,NULL,1,0,'',0
FROM #A A 


-- RECALCULO DATOS
EXEC SPK_CALCULAR_NEMPF '01201702P30-1','' 

SELECT COUNT(*) FROM NEMP INNER JOIN #A A ON NEMP.NUMDOC=A.NUMDOC WHERE NEMP.CCOSTO<>A.CCOSTO OR NEMP.CODCARGO<>A.CARGO
		  


