SELECT   '2' TIPO, ROW_NUMBER ()OVER (ORDER BY FCOMD.IDARTICULO) N, MONTH(FCOM.FECHA) MES, ISNULL (IART.CODCUM, '') CODCUM, MINIMO.VLR_MINI , MAXI.VLR_MAX, SUM(FCOMD.VR_TOTAL) VRL_NETO,
       SUM(FCOMD.CANTIDAD) TOTAL_CANTIDAD, MINIMO.FACT_MINI, MAXI.FACT_MAX, '', IART.DESCRIPCION, IART.IDARTICULO
FROM FCOM INNER JOIN FCOMD ON FCOM.CNSFCOM    = FCOMD.CNSFCOM   INNER JOIN IART  ON IART.IDARTICULO = FCOMD.IDARTICULO  INNER JOIN TER ON FCOM.IDTERCERO = TER.IDTERCERO 
	         LEFT JOIN (SELECT MIN (FCOM.N_FACTURA) FACT_MINI , MINIMO.VLR_MINI, FCOMD.IDARTICULO FROM FCOM JOIN FCOMD ON FCOM.CNSFCOM = FCOMD.CNSFCOM
                     INNER JOIN IART  ON IART.IDARTICULO = FCOMD.IDARTICULO INNER JOIN (SELECT MIN(FCOMD.VLR_UNITARIO) VLR_MINI, FCOMD.IDARTICULO
 FROM FCOM MINI JOIN FCOMD ON MINI.CNSFCOM = FCOMD.CNSFCOM INNER JOIN IART  ON IART.IDARTICULO = FCOMD.IDARTICULO 
 WHERE MINI.FECHA BETWEEN @FECHA1 AND @FECHA2 AND IART.IDSERVICIO LIKE @SERVICIO GROUP BY FCOMD.IDARTICULO) MINIMO ON FCOMD.IDARTICULO = MINIMO.IDARTICULO 
                    WHERE FCOM.FECHA BETWEEN  @FECHA1 AND @FECHA2  AND IART.IDSERVICIO LIKE @SERVICIO
                    GROUP BY MINIMO.VLR_MINI, FCOMD.IDARTICULO) MINIMO ON FCOMD.IDARTICULO = MINIMO.IDARTICULO
	       LEFT JOIN (SELECT MAX (FCOM.N_FACTURA) FACT_MAX , MAXIMO.VLR_MAX, FCOMD.IDARTICULO
	    FROM FCOM JOIN FCOMD ON FCOM.CNSFCOM = FCOMD.CNSFCOM INNER JOIN IART  ON IART.IDARTICULO = FCOMD.IDARTICULO
                    INNER JOIN (SELECT MAX(FCOMD.VLR_UNITARIO) VLR_MAX, FCOMD.IDARTICULO FROM FCOM MAXI JOIN FCOMD ON MAXI.CNSFCOM = FCOMD.CNSFCOM
	    INNER JOIN IART  ON IART.IDARTICULO = FCOMD.IDARTICULO   WHERE MAXI.FECHA BETWEEN @FECHA1 AND @FECHA2  AND IART.IDSERVICIO LIKE @SERVICIO
	  GROUP BY FCOMD.IDARTICULO) MAXIMO ON FCOMD.IDARTICULO = MAXIMO.IDARTICULO 
	 WHERE FCOM.FECHA BETWEEN  @FECHA1 AND @FECHA2  AND IART.IDSERVICIO LIKE @SERVICIO
               GROUP BY MAXIMO.VLR_MAX, FCOMD.IDARTICULO) MAXI ON FCOMD.IDARTICULO = MAXI.IDARTICULO
WHERE FCOM.FECHA BETWEEN @FECHA1 AND @FECHA2 
AND IDBODEGA = '07'  AND IART.IDSERVICIO LIKE @SERVICIO AND IART.IDITAR IN ('01')
AND FCOM.COMPANIA = '01'
GROUP BY  IART.DESCRIPCION, YEAR(FCOM.FECHA), MONTH(FCOM.FECHA), IART.CODCUM, FCOMD.IDARTICULO, MINIMO.FACT_MINI , MINIMO.VLR_MINI,
         MAXI.FACT_MAX, MAXI.VLR_MAX,IART.IDARTICULO, IART.IDARTICULO