IF EXISTS(SELECT NAME FROM SYSOBJECTS WHERE NAME='FNK_COLUMNAS_TABLAS' AND XTYPE='FN')
BEGIN
   DROP FUNCTION FNK_COLUMNAS_TABLAS
END
GO
CREATE FUNCTION DBO.FNK_COLUMNAS_TABLAS(@TABLA VARCHAR(100))
RETURNS VARCHAR(MAX)
AS
BEGIN
   DECLARE @CANT    INT
   DECLARE @COLUMNA VARCHAR(200)
   DECLARE @I       INT
   DECLARE @TEXT    VARCHAR(MAX)
   DECLARE @LEN     INT
   DECLARE @BANDERA INT
   DECLARE @IDOBJETO INT
   SELECT @I =1,@BANDERA=1
   
   SELECT @IDOBJETO=id FROM sysobjects  WHERE name=@TABLA
   SELECT @CANT=COUNT(*) FROM SYS.all_columns WHERE object_id = @IDOBJETO
   AND is_identity=0
   AND is_computed=0

   DECLARE PG_CURSOR CURSOR FOR 
   SELECT NAME FROM SYS.all_columns WHERE object_id =@IDOBJETO
   AND is_identity=0
   AND is_computed=0
   ORDER BY column_id
   OPEN PG_CURSOR    
   FETCH NEXT FROM PG_CURSOR    
   INTO @COLUMNA
   WHILE @@FETCH_STATUS = 0    
   BEGIN 
      SELECT @TEXT=COALESCE(@TEXT,'')+@COLUMNA
      IF @I<@CANT
      BEGIN
         SELECT @TEXT=COALESCE(@TEXT,'')+', '
      END
      SELECT @LEN=LEN(@TEXT)
      IF @LEN/@BANDERA>=180
      BEGIN
         SELECT @TEXT=@TEXT+CHAR(13)
         SELECT @BANDERA=@BANDERA+1
      END
      SELECT @I=@I+1         
   FETCH NEXT FROM PG_CURSOR    
   INTO @COLUMNA
   END
   CLOSE PG_CURSOR
   DEALLOCATE PG_CURSOR
   RETURN @TEXT
END 

