IF EXISTS(SELECT NAME FROM SYSOBJECTS WHERE NAME='FNK_COLUMNAS_TABLAS_TEMP' AND XTYPE='FN')
BEGIN
   DROP FUNCTION FNK_COLUMNAS_TABLAS_TEMP
END
GO
CREATE FUNCTION DBO.FNK_COLUMNAS_TABLAS_TEMP(@TABLA VARCHAR(20),@ACCION SMALLINT = 0)
RETURNS VARCHAR(MAX)
AS
BEGIN
   DECLARE @CANT INT
   DECLARE @I    INT
   DECLARE @TEXT VARCHAR(MAX)
   DECLARE @T_CAMPO VARCHAR(20)
   DECLARE @COLUMN VARCHAR(100)
   SELECT @I =1,@TEXT=''
  
   SELECT @CANT= COUNT(*)
   FROM tempdb.INFORMATION_SCHEMA.COLUMNS
   WHERE TABLE_NAME LIKE''+@TABLA+'%'
   
   WHILE @I<= @CANT
   BEGIN
      IF @ACCION=0
      BEGIN
         SELECT @TEXT=COALESCE(@TEXT,'')+COLUMN_NAME,@T_CAMPO=DATA_TYPE
         FROM tempdb.INFORMATION_SCHEMA.COLUMNS
         WHERE TABLE_NAME LIKE''+@TABLA+'%'
         AND ORDINAL_POSITION=@I

         IF @I>=1 AND @I<@CANT
         BEGIN
            SELECT @TEXT=@TEXT+', '
         END
      END

      IF @ACCION=1
      BEGIN
         SELECT @COLUMN=COLUMN_NAME,@T_CAMPO=DATA_TYPE
         FROM tempdb.INFORMATION_SCHEMA.COLUMNS
         WHERE TABLE_NAME LIKE''+@TABLA+'%'
         AND ORDINAL_POSITION=@I
         IF UPPER(@T_CAMPO) IN('INT','NUMERIC','DECIMAL','SMALLINT','BIT')
         BEGIN
            SELECT @TEXT= @TEXT+'LTRIM(RTRIM(STR('+@COLUMN+')))'
         END
         ELSE
         BEGIN
            IF UPPER(@T_CAMPO) LIKE '%DATE%' OR  UPPER(@T_CAMPO) LIKE '%TIME%'
            BEGIN
               SELECT @TEXT= @TEXT+'LTRIM(RTRIM(CONVERT(VARCHAR,'+@COLUMN+')))'
            END
            ELSE
            BEGIN
                SELECT @TEXT= @TEXT+'LTRIM(RTRIM('+@COLUMN+'))'
            END
         END
         IF @I>=1 AND @I<@CANT
         BEGIN
            SELECT @TEXT= @TEXT+'+'+''','''+'+'
         END
      END
      SELECT @I=@I+1         
   END

   RETURN @TEXT
END 
   
   




